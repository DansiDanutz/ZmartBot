# zmart-api.mdc
> Type: backend | Version: 1.0.0 | Owner: zmartbot | Port: 8000

## Overview
ZmartBot main API server providing trading, market data, and system management endpoints with comprehensive rate limiting, caching, and security features.

## Architecture & Integration
- **Service Type:** backend
- **Dependencies:** rate_limiting_service, cryptometer, kucoin, binance
- **Env Vars:** BINANCE_API_KEY, BINANCE_SECRET, KUCOIN_API_KEY, KUCOIN_SECRET, CRYPTOMETER_API_KEY
- **Lifecycle:** start=`python3 start_backend_safe.py` | stop=`pkill -f start_backend_safe` | migrate=`n/a`

## API Endpoints

### GET /api/v1/trading/accounts
- Summary: Get trading account information
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: Account balance and trading permissions
  - 401: Authentication failed
  - 429: Rate limit exceeded

### GET /api/v1/trading/positions
- Summary: Get current trading positions
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: List of active positions with PnL
  - 401: Authentication failed

### POST /api/v1/trading/orders
- Summary: Place new trading order
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{"symbol": "string", "side": "BUY|SELL", "quantity": "float", "order_type": "MARKET|LIMIT", "price": "float?"}`
- Responses:
  - 200: Order confirmation with order ID
  - 400: Invalid order parameters
  - 401: Authentication failed

### GET /api/v1/market-data/{symbol}
- Summary: Get market data for symbol
- Auth Required: No
- Request:
  - Params: `{"symbol": "string"}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: Real-time market data
  - 404: Symbol not found

### GET /api/v1/cryptometer/analysis
- Summary: Get Cryptometer technical analysis
- Auth Required: No
- Request:
  - Params: `{}`
  - Query: `{"symbol": "string", "timeframe": "string"}`
  - Body: `{}`
- Responses:
  - 200: Technical analysis data
  - 400: Invalid parameters

### GET /api/v1/riskmetric/bands
- Summary: Get RiskMetric risk bands
- Auth Required: No
- Request:
  - Params: `{}`
  - Query: `{"symbol": "string"}`
  - Body: `{}`
- Responses:
  - 200: Risk band data
  - 404: Symbol not found

### GET /api/v1/futures-symbols/{exchange}/available
- Summary: Get available futures symbols
- Auth Required: No
- Request:
  - Params: `{"exchange": "kucoin|binance"}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: List of available symbols
  - 400: Invalid exchange

### GET /api/v1/my-symbols
- Summary: Get user's portfolio symbols
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: Portfolio symbols data
  - 401: Authentication failed

### POST /api/v1/my-symbols
- Summary: Update user's portfolio symbols
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{"symbols": ["string"]}`
- Responses:
  - 200: Portfolio updated successfully
  - 400: Invalid symbols
  - 401: Authentication failed

### GET /api/v1/alerts
- Summary: Get trading alerts
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: List of active alerts
  - 401: Authentication failed

### POST /api/v1/alerts
- Summary: Create new trading alert
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{"symbol": "string", "condition": "string", "price": "float", "action": "string"}`
- Responses:
  - 200: Alert created successfully
  - 400: Invalid alert parameters
  - 401: Authentication failed

## Health & Readiness
- Liveness: `/health`
- Readiness: `/ready`
- Timeouts: startup_grace=30s, http_timeout=30s

## Observability
- Metrics: `/metrics`
- Logs: format=jsonl
- Dashboards: API Performance, Trading Metrics

## Orchestration & Ordering
- Basic Integration: Enabled
- Master Agent Linked: Yes
- Ordering Hints: rate_limiting_service → zmart-api

## Performance & SLO (Initial)
- Baseline p95 (ms): 200
- Notes: Handles all API requests with rate limiting and caching

## Failure Modes & Runbooks
- **rate-limit-exceeded** — Symptoms: 429 responses, API delays — Remediation: Implement exponential backoff, reduce request frequency
- **database-connection-failed** — Symptoms: Database errors, service unavailable — Remediation: Check database connectivity, restart service
- **memory-exhaustion** — Symptoms: High memory usage, service crashes — Remediation: Monitor memory usage, implement cleanup

## Rollback
- Snapshot required: Yes
- Playbook: isolate → restore_latest_snapshot → verify → reactivate

## Load Balancing
- Enabled: Yes
- Pool: api_pool

## Known Issues
- None recorded

## Changelog
- 1.0.0 (2025-08-24): Initial comprehensive API server with all trading endpoints

---
*Generated by MDCAgent (gpt5) on 2025-08-24T23:30:00Z; input sha256-def456ghi789; context: service.yaml, zmart_api_context.json.*
description:
globs:
alwaysApply: true
---
