<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZmartTrade - AI Trading Assistant</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/themes.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="theme-dark">
    <!-- App Container -->
    <div id="app" class="app-container">

        <!-- Onboarding Screens -->
        <div id="onboarding" class="onboarding-container">

            <!-- Welcome Screen -->
            <div id="welcome-screen" class="onboarding-screen active">
                <div class="theme-toggle">
                    <button id="theme-btn" class="theme-button" onclick="toggleTheme()">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>
                </div>

                <div class="welcome-content">
                    <div class="logo-animation">
                        <div class="logo-circle">
                            <span class="logo-text">Z</span>
                        </div>
                        <div class="pulse-ring"></div>
                        <div class="pulse-ring delay-1"></div>
                        <div class="pulse-ring delay-2"></div>
                    </div>

                    <h1 class="welcome-title">Welcome to ZmartTrade</h1>
                    <p class="welcome-subtitle">Your AI-powered trading assistant</p>

                    <div class="features-list">
                        <div class="feature-item">
                            <span class="feature-icon">üìà</span>
                            <span>Real-time market analysis</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ü§ñ</span>
                            <span>AI trading signals</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">üí¨</span>
                            <span>24/7 chat support</span>
                        </div>
                    </div>

                    <button class="primary-button" onclick="nextScreen('name-screen')">
                        Get Started
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Name Input Screen -->
            <div id="name-screen" class="onboarding-screen">
                <button class="back-button" onclick="previousScreen('welcome-screen')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </button>

                <div class="screen-content">
                    <div class="icon-header">
                        <div class="icon-circle">üë§</div>
                    </div>

                    <h2>What should Zmarty call you?</h2>
                    <p class="screen-description">This helps us personalize your experience</p>

                    <div class="input-group">
                        <input
                            type="text"
                            id="user-name"
                            class="text-input"
                            placeholder="Enter your name"
                            maxlength="50"
                            autocomplete="name"
                        >
                        <span class="input-hint">Your name will be used in conversations</span>
                    </div>

                    <div id="name-preview" class="preview-box" style="display: none;">
                        <p>Zmarty will greet you as:</p>
                        <p class="preview-text">"Hello, <span id="preview-name"></span>! üëã"</p>
                    </div>

                    <button class="primary-button" id="continue-name" disabled onclick="nextScreen('contact-screen')">
                        Continue
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                            <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Contact Input Screen -->
            <div id="contact-screen" class="onboarding-screen">
                <button class="back-button" onclick="previousScreen('name-screen')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </button>

                <div class="screen-content">
                    <div class="icon-header">
                        <div class="icon-circle">üì±</div>
                    </div>

                    <h2>How should we reach you?</h2>
                    <p class="screen-description">We'll use this to secure your account</p>

                    <!-- Contact Type Toggle -->
                    <div class="toggle-group">
                        <button class="toggle-option active" data-type="phone" onclick="toggleContactType('phone')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                                <line x1="12" y1="18" x2="12.01" y2="18"></line>
                            </svg>
                            Phone
                        </button>
                        <button class="toggle-option" data-type="email" onclick="toggleContactType('email')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                                <polyline points="22,6 12,13 2,6"></polyline>
                            </svg>
                            Email
                        </button>
                    </div>

                    <!-- Phone Input -->
                    <div id="phone-input-group" class="input-group">
                        <div class="phone-input-wrapper">
                            <select id="country-code" class="country-select">
                                <option value="+1">üá∫üá∏ +1</option>
                                <option value="+44">üá¨üáß +44</option>
                                <option value="+49">üá©üá™ +49</option>
                                <option value="+33">üá´üá∑ +33</option>
                                <option value="+81">üáØüáµ +81</option>
                                <option value="+86">üá®üá≥ +86</option>
                                <option value="+91">üáÆüá≥ +91</option>
                                <option value="+7">üá∑üá∫ +7</option>
                            </select>
                            <input
                                type="tel"
                                id="phone-number"
                                class="text-input phone-input"
                                placeholder="Phone number"
                                pattern="[0-9]{10}"
                            >
                        </div>
                        <span class="input-hint">We'll send a verification code</span>
                    </div>

                    <!-- Email Input -->
                    <div id="email-input-group" class="input-group" style="display: none;">
                        <input
                            type="email"
                            id="email-address"
                            class="text-input"
                            placeholder="Enter your email"
                            autocomplete="email"
                        >
                        <span class="input-hint">We'll send a verification link</span>
                    </div>

                    <button class="primary-button" id="send-verification" disabled onclick="sendVerification()">
                        Send Verification Code
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Verification Screen -->
            <div id="verification-screen" class="onboarding-screen">
                <button class="back-button" onclick="previousScreen('contact-screen')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </button>

                <div class="screen-content">
                    <div class="icon-header">
                        <div class="icon-circle">üîê</div>
                    </div>

                    <h2>Enter verification code</h2>
                    <p class="screen-description">We sent a code to <span id="contact-display"></span></p>

                    <!-- OTP Input -->
                    <div class="otp-input-group">
                        <input type="text" maxlength="1" class="otp-input" data-index="0">
                        <input type="text" maxlength="1" class="otp-input" data-index="1">
                        <input type="text" maxlength="1" class="otp-input" data-index="2">
                        <input type="text" maxlength="1" class="otp-input" data-index="3">
                        <input type="text" maxlength="1" class="otp-input" data-index="4">
                        <input type="text" maxlength="1" class="otp-input" data-index="5">
                    </div>

                    <div class="resend-container">
                        <p>Didn't receive the code?</p>
                        <button id="resend-btn" class="text-button" disabled>
                            Resend in <span id="resend-timer">60</span>s
                        </button>
                    </div>

                    <button class="primary-button" id="verify-btn" disabled onclick="verifyCode()">
                        Verify & Continue
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Chat Interface (WhatsApp Style) -->
        <div id="chat-interface" class="chat-container" style="display: none;">

            <!-- Chat Header -->
            <header class="chat-header">
                <div class="header-left">
                    <button class="back-arrow" onclick="showMenu()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                    </button>
                    <div class="profile-pic">
                        <span>Z</span>
                        <div class="online-indicator"></div>
                    </div>
                    <div class="header-info">
                        <h3>Zmarty</h3>
                        <p class="status">AI Trading Assistant ‚Ä¢ Online</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="header-btn" title="Video call">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                        </svg>
                    </button>
                    <button class="header-btn" title="Voice call">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                    </button>
                    <button class="header-btn" onclick="toggleMenu()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="1"></circle>
                            <circle cx="12" cy="5" r="1"></circle>
                            <circle cx="12" cy="19" r="1"></circle>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- Dropdown Menu -->
            <div id="dropdown-menu" class="dropdown-menu">
                <button class="menu-item" onclick="newChat()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    New chat
                </button>
                <button class="menu-item" onclick="openSettings()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m18.4 5.6L17 14l4.4 4.4M5.6 5.6L10 10l-4.4 4.4"></path>
                    </svg>
                    Settings
                </button>
                <button class="menu-item" onclick="toggleTheme()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    Toggle theme
                </button>
                <button class="menu-item" onclick="openHelp()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    Help
                </button>
                <div class="menu-divider"></div>
                <button class="menu-item" onclick="logout()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </button>
            </div>

            <!-- Messages Container -->
            <div id="messages-container" class="messages-container">
                <!-- Date Separator -->
                <div class="date-separator">
                    <span>Today</span>
                </div>

                <!-- Welcome Message -->
                <div class="message received">
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>Welcome to ZmartTrade! üéâ</p>
                            <p>I'm Zmarty, your AI trading assistant. I can help you with:</p>
                            <ul>
                                <li>üìä Real-time market analysis</li>
                                <li>üíπ Trading signals and alerts</li>
                                <li>üíº Portfolio management</li>
                                <li>üìà Technical analysis</li>
                            </ul>
                            <p>How can I assist you today?</p>
                        </div>
                        <div class="message-info">
                            <span class="message-time">9:00 AM</span>
                            <span class="message-status">‚úì‚úì</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div id="typing-indicator" class="typing-indicator" style="display: none;">
                <div class="typing-bubble">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>

            <!-- Input Bar -->
            <div class="input-bar">
                <button class="attach-btn" onclick="openAttachMenu()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                    </svg>
                </button>

                <div class="input-wrapper">
                    <input
                        type="text"
                        id="message-input"
                        class="message-input"
                        placeholder="Type a message"
                        autocomplete="off"
                    >
                    <button class="emoji-btn" onclick="openEmojiPicker()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                            <line x1="9" y1="9" x2="9.01" y2="9"></line>
                            <line x1="15" y1="9" x2="15.01" y2="9"></line>
                        </svg>
                    </button>
                </div>

                <button id="send-btn" class="send-btn" onclick="sendMessage()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>

                <button id="voice-btn" class="voice-btn" style="display: none;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
            </div>

            <!-- Attachment Menu -->
            <div id="attach-menu" class="attach-menu">
                <button class="attach-option" onclick="attachDocument()">
                    <div class="attach-icon document">üìÑ</div>
                    <span>Document</span>
                </button>
                <button class="attach-option" onclick="attachCamera()">
                    <div class="attach-icon camera">üì∑</div>
                    <span>Camera</span>
                </button>
                <button class="attach-option" onclick="attachGallery()">
                    <div class="attach-icon gallery">üñºÔ∏è</div>
                    <span>Gallery</span>
                </button>
                <button class="attach-option" onclick="attachLocation()">
                    <div class="attach-icon location">üìç</div>
                    <span>Location</span>
                </button>
                <button class="attach-option" onclick="attachContact()">
                    <div class="attach-icon contact">üë§</div>
                    <span>Contact</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Scripts -->
    <script src="src/app.js"></script>
    <script src="src/onboarding.js"></script>
    <script src="src/chat.js"></script>
    <script src="src/auth.js"></script>

    <!-- Zmarty AI System -->
    <script src="src/zmarty-ai-agent.js"></script>
    <script src="src/zmarty-manus-connector.js"></script>
    <script src="src/zmarty-initializer.js"></script>

    <!-- Activate Zmarty Integration -->
    <script>
        // Fire userRegistered event after successful registration
        document.addEventListener('DOMContentLoaded', () => {
            // Listen for successful OTP verification
            if (window.zmartAuth) {
                const originalVerifyOTP = window.zmartAuth.verifyOTP;
                window.zmartAuth.verifyOTP = async function(contact, code) {
                    const result = await originalVerifyOTP.call(this, contact, code);
                    if (result.success && result.user) {
                        // Fire event to activate Zmarty
                        window.dispatchEvent(new CustomEvent('userRegistered', {
                            detail: result.user
                        }));
                    }
                    return result;
                };
            }
        });
    </script>
</body>
</html>