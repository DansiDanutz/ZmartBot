<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZmartBot - System Monitoring Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; }
        .status-online { background-color: #10b981; }
        .status-warning { background-color: #f59e0b; }
        .status-offline { background-color: #ef4444; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <div class="gradient-bg px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center text-gray-900 font-bold text-xl">
                    Z
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-white">ZmartBot System Monitor</h1>
                    <p class="text-blue-200 text-sm">Real-time system health & performance</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="glass px-4 py-2 rounded-lg">
                    <div class="flex items-center space-x-2">
                        <div class="status-indicator status-online pulse"></div>
                        <span class="text-sm font-medium">System Online</span>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-sm text-blue-200">Last Update</div>
                    <div class="font-mono text-sm" id="lastUpdate">--:--:--</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="p-6">
        <!-- Key Metrics Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- API Health -->
            <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-200">API Server</h3>
                    <div class="status-indicator" id="apiStatus"></div>
                </div>
                <div class="text-3xl font-bold text-white mb-2" id="apiResponseTime">--ms</div>
                <div class="text-sm text-gray-400">Response Time</div>
                <div class="mt-3 text-sm">
                    <span class="text-green-400" id="apiEndpoints">0/0</span> endpoints healthy
                </div>
            </div>

            <!-- Database -->
            <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-200">Database</h3>
                    <div class="status-indicator" id="dbStatus"></div>
                </div>
                <div class="text-3xl font-bold text-white mb-2" id="dbConnections">--</div>
                <div class="text-sm text-gray-400">Active Pools</div>
                <div class="mt-3 text-sm">
                    <span class="text-blue-400" id="dbTables">5</span> tables ready
                </div>
            </div>

            <!-- MCP Services -->
            <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-200">MCP Tools</h3>
                    <div class="status-indicator" id="mcpStatus"></div>
                </div>
                <div class="text-3xl font-bold text-white mb-2" id="mcpActive">--</div>
                <div class="text-sm text-gray-400">Active Services</div>
                <div class="mt-3 text-sm">
                    <span class="text-purple-400" id="mcpTotal">6</span> tools available
                </div>
            </div>

            <!-- System Load -->
            <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-200">System Load</h3>
                    <div class="status-indicator" id="systemStatus"></div>
                </div>
                <div class="text-3xl font-bold text-white mb-2" id="processCount">--</div>
                <div class="text-sm text-gray-400">Running Processes</div>
                <div class="mt-3 text-sm">
                    CPU: <span class="text-yellow-400" id="cpuUsage">--%</span>
                </div>
            </div>
        </div>

        <!-- Charts and Details Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- System Performance Chart -->
            <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                <h3 class="text-lg font-semibold text-gray-200 mb-4">API Response Times (Last 10 minutes)</h3>
                <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>

            <!-- Service Status -->
            <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Service Health Overview</h3>
                <div class="space-y-4" id="serviceList">
                    <!-- Services will be populated here -->
                </div>
            </div>
        </div>

        <!-- Recent Activity & Logs -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Recent API Calls -->
            <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                <h3 class="text-lg font-semibold text-gray-200 mb-4">Recent API Activity</h3>
                <div class="space-y-3" id="apiActivity">
                    <!-- Activity will be populated here -->
                </div>
            </div>

            <!-- System Alerts -->
            <div class="bg-gray-800 rounded-xl p-6 border border-gray-700">
                <h3 class="text-lg font-semibold text-gray-200 mb-4">System Alerts</h3>
                <div class="space-y-3" id="systemAlerts">
                    <!-- Alerts will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dashboard State
        const dashboardState = {
            lastUpdate: null,
            performanceData: [],
            services: [
                { name: 'ZmartBot API', endpoint: '/v1/health', status: 'unknown' },
                { name: 'Trading Signals', endpoint: '/v1/signals/snapshot?symbol=BTC', status: 'unknown' },
                { name: 'Pool Management', endpoint: '/v1/pools/1', status: 'unknown' },
                { name: 'Frontend App', port: 3000, status: 'unknown' },
                { name: 'Database', type: 'sqlite', status: 'unknown' },
                { name: 'MCP Services', type: 'process', status: 'unknown' }
            ]
        };

        // Performance Chart Setup
        const ctx = document.getElementById('performanceChart').getContext('2d');
        const performanceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Response Time (ms)',
                    data: [],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#9ca3af' }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#6b7280' },
                        grid: { color: '#374151' }
                    },
                    y: {
                        ticks: { color: '#6b7280' },
                        grid: { color: '#374151' }
                    }
                }
            }
        });

        // Utility Functions
        function updateLastUpdateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
            dashboardState.lastUpdate = now;
        }

        function updateStatusIndicator(elementId, status) {
            const element = document.getElementById(elementId);
            element.className = 'status-indicator';
            
            switch(status) {
                case 'online':
                    element.classList.add('status-online', 'pulse');
                    break;
                case 'warning':
                    element.classList.add('status-warning');
                    break;
                case 'offline':
                    element.classList.add('status-offline');
                    break;
            }
        }

        // API Health Check
        async function checkAPIHealth() {
            const baseURL = 'http://localhost:8000';
            let healthyEndpoints = 0;
            let totalResponseTime = 0;
            
            for (let service of dashboardState.services.slice(0, 3)) {
                try {
                    const start = performance.now();
                    const response = await fetch(baseURL + service.endpoint);
                    const end = performance.now();
                    const responseTime = end - start;
                    
                    if (response.ok) {
                        service.status = 'online';
                        healthyEndpoints++;
                        totalResponseTime += responseTime;
                    } else {
                        service.status = 'warning';
                    }
                } catch (error) {
                    service.status = 'offline';
                }
            }
            
            const avgResponseTime = healthyEndpoints > 0 ? Math.round(totalResponseTime / healthyEndpoints) : 0;
            
            // Update UI
            document.getElementById('apiResponseTime').textContent = avgResponseTime + 'ms';
            document.getElementById('apiEndpoints').textContent = healthyEndpoints + '/3';
            
            updateStatusIndicator('apiStatus', healthyEndpoints === 3 ? 'online' : 
                                                 healthyEndpoints > 0 ? 'warning' : 'offline');
            
            // Update performance chart
            const now = new Date().toLocaleTimeString();
            dashboardState.performanceData.push({ time: now, value: avgResponseTime });
            
            // Keep only last 10 data points
            if (dashboardState.performanceData.length > 10) {
                dashboardState.performanceData.shift();
            }
            
            performanceChart.data.labels = dashboardState.performanceData.map(d => d.time);
            performanceChart.data.datasets[0].data = dashboardState.performanceData.map(d => d.value);
            performanceChart.update('none');
        }

        // Update Service List UI
        function updateServiceList() {
            const serviceList = document.getElementById('serviceList');
            serviceList.innerHTML = '';
            
            dashboardState.services.forEach(service => {
                const statusColor = service.status === 'online' ? 'text-green-400' : 
                                  service.status === 'warning' ? 'text-yellow-400' : 'text-red-400';
                
                const statusIcon = service.status === 'online' ? '●' : 
                                 service.status === 'warning' ? '⚠' : '●';
                
                serviceList.innerHTML += `
                    <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <span class="${statusColor} text-xl">${statusIcon}</span>
                            <span class="font-medium">${service.name}</span>
                        </div>
                        <div class="text-sm ${statusColor} capitalize">${service.status}</div>
                    </div>
                `;
            });
        }

        // Simulate other metrics updates
        function updateMetrics() {
            // Database metrics
            document.getElementById('dbConnections').textContent = Math.floor(Math.random() * 5) + 1;
            updateStatusIndicator('dbStatus', 'online');
            
            // MCP Services
            document.getElementById('mcpActive').textContent = '4/6';
            updateStatusIndicator('mcpStatus', 'warning');
            
            // System Load
            const processCount = Math.floor(Math.random() * 20) + 45;
            document.getElementById('processCount').textContent = processCount;
            document.getElementById('cpuUsage').textContent = Math.floor(Math.random() * 30) + 15 + '%';
            updateStatusIndicator('systemStatus', processCount > 60 ? 'warning' : 'online');
        }

        // Add recent activity
        function addRecentActivity() {
            const activities = [
                'GET /v1/signals/snapshot?symbol=BTC - 200 OK',
                'POST /v1/pools - 200 OK (Pool Created)',  
                'GET /v1/health - 200 OK',
                'GET /v1/pools/1 - 200 OK',
                'Background job: Expired pools processing completed'
            ];
            
            const apiActivity = document.getElementById('apiActivity');
            const now = new Date().toLocaleTimeString();
            
            const randomActivity = activities[Math.floor(Math.random() * activities.length)];
            
            apiActivity.innerHTML = `
                <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg">
                    <div class="font-mono text-sm text-green-400">${randomActivity}</div>
                    <div class="text-xs text-gray-400">${now}</div>
                </div>
            ` + apiActivity.innerHTML;
            
            // Keep only last 5 activities
            const activities_dom = apiActivity.children;
            if (activities_dom.length > 5) {
                apiActivity.removeChild(activities_dom[5]);
            }
        }

        // Add system alerts
        function updateAlerts() {
            const alerts = [
                { type: 'info', message: 'System health check completed successfully' },
                { type: 'warning', message: 'Cryptometer service using fallback data' },
                { type: 'info', message: 'Pool expiry background job running' },
                { type: 'warning', message: 'OpenTelemetry endpoint configuration needed' }
            ];
            
            const systemAlerts = document.getElementById('systemAlerts');
            systemAlerts.innerHTML = '';
            
            alerts.forEach(alert => {
                const colorClass = alert.type === 'warning' ? 'text-yellow-400' : 'text-blue-400';
                const icon = alert.type === 'warning' ? '⚠' : 'ℹ';
                
                systemAlerts.innerHTML += `
                    <div class="flex items-start space-x-3 p-3 bg-gray-700 rounded-lg">
                        <span class="${colorClass} text-lg">${icon}</span>
                        <div class="flex-1">
                            <div class="text-sm">${alert.message}</div>
                            <div class="text-xs text-gray-400 mt-1">${new Date().toLocaleTimeString()}</div>
                        </div>
                    </div>
                `;
            });
        }

        // Main update function
        async function updateDashboard() {
            updateLastUpdateTime();
            await checkAPIHealth();
            updateServiceList();
            updateMetrics();
            addRecentActivity();
            updateAlerts();
        }

        // Initialize dashboard
        async function initDashboard() {
            console.log('🚀 ZmartBot Monitoring Dashboard Initializing...');
            await updateDashboard();
            
            // Update every 5 seconds
            setInterval(updateDashboard, 5000);
            
            console.log('✅ Dashboard Online - Auto-refresh every 5 seconds');
        }

        // Start dashboard when page loads
        window.addEventListener('load', initDashboard);
    </script>
</body>
</html>