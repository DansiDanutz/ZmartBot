#!/bin/bash

# ZmartBot Safe Auto-Start Script for Cursor/VS Code
# This script runs in background without blocking shell initialization

# Function to run ZmartBot startup in background
start_zmartbot_background() {
    {
        echo "=========================================="
        echo "ðŸš€ ZmartBot Auto-Start Initializing..."
        echo "=========================================="
        
        # Set working directory
        cd /Users/dansidanutz/Desktop/ZmartBot/zmart-api
        
        # 1. Memory Optimization (non-blocking)
        echo ""
        echo "ðŸ§¹ Step 1: Optimizing Memory..."
        echo "------------------------------------------"
        if [ -f "./optimize_memory.sh" ]; then
            ./optimize_memory.sh > /tmp/zmartbot_optimize.log 2>&1 &
        fi
        
        # 2. Start Main API (non-blocking)
        echo ""
        echo "ðŸ”¥ Step 2: Starting Main API Server..."
        echo "------------------------------------------"
        if [ -f "./start_main_api.sh" ]; then
            ./start_main_api.sh > /tmp/zmartbot_api.log 2>&1 &
        fi
        
        # Wait for API to start
        sleep 3
        
        # 3. Health Check (non-blocking)
        echo ""
        echo "ðŸ“Š Step 3: Running Health Check..."
        echo "------------------------------------------"
        if [ -f "system_health_check.py" ]; then
            python3 system_health_check.py > /tmp/zmartbot_health.log 2>&1 &
        fi
        
        echo ""
        echo "=========================================="
        echo "âœ… ZmartBot Auto-Start Complete!"
        echo "=========================================="
        echo ""
        echo "ðŸ“Œ Available Commands:"
        echo "  â€¢ Health Check: python3 system_health_check.py"
        echo "  â€¢ Optimize Memory: ./optimize_memory.sh"
        echo "  â€¢ API Status: curl http://localhost:8000/health"
        echo ""
        echo "ðŸ“Š Services Running:"
        echo "  â€¢ Main API: http://localhost:8000"
        echo "  â€¢ API Keys Manager: http://localhost:8006"
        echo ""
        
    } > /tmp/zmartbot_startup.log 2>&1 &
}

# Only start if not already running
if ! pgrep -f "zmartbot" > /dev/null; then
    start_zmartbot_background
fi













