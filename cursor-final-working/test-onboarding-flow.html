<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Onboarding Flow</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .test-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f7f9fc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .test-log {
            max-height: 300px;
            overflow-y: auto;
            background: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            margin-top: 10px;
        }
        .step-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            background: #e9ecef;
            color: #495057;
            font-size: 14px;
            margin-right: 10px;
        }
        .iframe-container {
            margin-top: 20px;
            border: 2px solid #667eea;
            border-radius: 8px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ ZmartyBrain Onboarding Flow Test</h1>

        <div class="test-section">
            <h3>üì± Live Site Test</h3>
            <button onclick="testLiveSite()">Run Complete Test</button>
            <button onclick="openInNewTab()">Open in New Tab</button>
            <div id="live-results"></div>
        </div>

        <div class="test-section">
            <h3>üîç Step-by-Step Test</h3>
            <div id="step-tests"></div>
        </div>

        <div class="test-section">
            <h3>üìä Test Results Summary</h3>
            <div id="summary"></div>
            <div class="test-log" id="test-log"></div>
        </div>

        <div class="iframe-container">
            <iframe id="test-frame" src="https://vermillion-paprenjak-67497b.netlify.app/"></iframe>
        </div>
    </div>

    <script>
        const testUrl = 'https://vermillion-paprenjak-67497b.netlify.app/';
        let testLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            testLog.push(logEntry);

            const logEl = document.getElementById('test-log');
            logEl.innerHTML = testLog.join('\n');
            logEl.scrollTop = logEl.scrollHeight;

            console.log(logEntry);
        }

        function openInNewTab() {
            window.open(testUrl, '_blank');
            log('Opened site in new tab for manual testing', 'info');
        }

        async function testLiveSite() {
            const results = document.getElementById('live-results');
            results.innerHTML = '<div class="warning">Testing in progress...</div>';

            const tests = [
                {
                    name: 'Site Accessibility',
                    test: async () => {
                        try {
                            const response = await fetch(testUrl, { mode: 'no-cors' });
                            return { success: true, message: 'Site is accessible' };
                        } catch (error) {
                            return { success: false, message: `Site not accessible: ${error.message}` };
                        }
                    }
                },
                {
                    name: 'Supabase Connection',
                    test: async () => {
                        // Test Supabase endpoint
                        try {
                            const response = await fetch('https://xhskmqsgtdhehzlvtuns.supabase.co/auth/v1/health', {
                                mode: 'no-cors'
                            });
                            return { success: true, message: 'Supabase is reachable' };
                        } catch (error) {
                            return { success: false, message: 'Supabase connection issue' };
                        }
                    }
                }
            ];

            let allPassed = true;
            let resultsHtml = '';

            for (const test of tests) {
                log(`Running test: ${test.name}`, 'info');
                const result = await test.test();

                if (!result.success) allPassed = false;

                resultsHtml += `
                    <div class="test-result ${result.success ? 'success' : 'error'}">
                        <strong>${test.name}:</strong> ${result.message}
                    </div>
                `;

                log(`${test.name}: ${result.message}`, result.success ? 'success' : 'error');
            }

            results.innerHTML = resultsHtml;

            // Run step-by-step test
            testSteps();
        }

        function testSteps() {
            const steps = [
                { num: 1, name: 'Welcome', expected: 'Get Started button visible' },
                { num: 2, name: 'Authentication', expected: 'Email/Google tabs visible' },
                { num: 3, name: 'Account Confirmation', expected: 'Confirmation message' },
                { num: 4, name: 'Email Verification', expected: '6-digit code input' },
                { num: 5, name: 'Password Reset', expected: 'Password reset form' },
                { num: 6, name: 'Choose Plan', expected: 'Tier selection cards' },
                { num: 7, name: 'Complete Profile', expected: 'Profile form fields' },
                { num: 8, name: 'Welcome Complete', expected: 'Success message' },
                { num: 9, name: 'Final', expected: 'Dashboard redirect or completion' }
            ];

            const stepsEl = document.getElementById('step-tests');
            let stepsHtml = '<h4>Expected Flow:</h4>';

            steps.forEach(step => {
                stepsHtml += `
                    <div style="margin: 10px 0;">
                        <span class="step-indicator">Step ${step.num}</span>
                        <strong>${step.name}</strong> ‚Üí ${step.expected}
                    </div>
                `;
                log(`Step ${step.num}: ${step.name} - ${step.expected}`, 'info');
            });

            stepsEl.innerHTML = stepsHtml;

            // Test with iframe
            testIframeFlow();
        }

        function testIframeFlow() {
            const iframe = document.getElementById('test-frame');
            const summary = document.getElementById('summary');

            iframe.onload = () => {
                log('Iframe loaded successfully', 'success');

                try {
                    // Try to access iframe content (will fail due to CORS)
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    log('Can access iframe content', 'success');
                } catch (e) {
                    log('Cannot access iframe content due to CORS (expected)', 'warning');

                    summary.innerHTML = `
                        <div class="warning">
                            <strong>‚ö†Ô∏è Limited Testing Due to CORS</strong><br>
                            The site loads but automated testing is limited due to cross-origin restrictions.<br>
                            Please test manually by clicking through each step in the iframe below or opening in a new tab.
                        </div>
                        <br>
                        <div class="success">
                            <strong>‚úÖ What Works:</strong><br>
                            ‚Ä¢ Site loads successfully<br>
                            ‚Ä¢ Netlify deployment is active<br>
                            ‚Ä¢ HTTPS is configured<br>
                            ‚Ä¢ Responsive design visible
                        </div>
                        <br>
                        <div class="error">
                            <strong>‚ùå Manual Testing Required:</strong><br>
                            ‚Ä¢ Email registration flow<br>
                            ‚Ä¢ Google OAuth flow<br>
                            ‚Ä¢ Email verification<br>
                            ‚Ä¢ Tier selection<br>
                            ‚Ä¢ Profile completion
                        </div>
                    `;
                }
            };

            iframe.onerror = () => {
                log('Failed to load iframe', 'error');
                summary.innerHTML = '<div class="error">Failed to load the onboarding site</div>';
            };
        }

        // Auto-run test on load
        window.onload = () => {
            log('Test suite initialized', 'info');
            log(`Testing URL: ${testUrl}`, 'info');
            testLiveSite();
        };
    </script>
</body>
</html>