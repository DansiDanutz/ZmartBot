# Background-Mdc-Agent - Merged MDC Configuration

## üîó Merged from 2 duplicate files
**Merged Files**: background-mdc-agent.mdc, background_mdc_agent.mdc
**Merge Date**: 2025-08-27 10:39:58
**Primary Source**: background-mdc-agent.mdc

## üìã Primary Configuration
# Background-Mdc-Agent - Merged MDC Configuration

## üîó Merged from 2 duplicate files
**Merged Files**: background-mdc-agent.mdc, background_mdc_agent.mdc
**Merge Date**: 2025-08-26 09:03:52
**Primary Source**: background-mdc-agent.mdc

## üìã Primary Configuration
# background-mdc-agent.mdc
> Type: monitoring | Version: 1.0.0 | Owner: zmartbot | Port: n/a

## Overview
Background monitoring agent for automatic MDC file updates and CLAUDE.md synchronization with comprehensive file change detection, automatic updates, and graceful error handling.

## Architecture & Integration
- **Service Type:** monitoring
- **Dependencies:** smart_context_optimizer, update_master_orchestration
- **Env Vars:** None required
- **Lifecycle:** start=`./start_background_mdc_agent.sh` | stop=`./stop_background_mdc_agent.sh` | migrate=`n/a`

## Core Functionality

### Primary Purpose
Automatically monitor MDC files and update CLAUDE.md and Master Orchestration Agent with comprehensive file change detection and error recovery.

### Key Features
- **File Change Detection**: Monitors all MDC files for new, modified, or deleted files
- **Automatic CLAUDE.md Updates**: Triggers smart context optimizer when changes detected
- **Master Orchestration Synchronization**: Updates Master Orchestration Agent automatically
- **Stale File Detection**: Forces updates if CLAUDE.md is older than 24 hours
- **Comprehensive Logging**: All activities logged with timestamps
- **Graceful Shutdown**: Handles SIGINT/SIGTERM signals properly
- **Error Recovery**: Automatic retry logic with exponential backoff

### Automation
- **Trigger**: Time-based (every 5 minutes) + file change detection
- **Frequency**: 300 seconds (5 minutes)
- **Scope**: Full MDC system monitoring and updates

## Technical Implementation

### Class Structure
```python
class BackgroundMDCAgent:
    - get_mdc_files_info()      # Get MDC file information
    - check_for_changes()       # Detect file changes
    - update_claude_md()        # Update CLAUDE.md
    - update_master_orchestration()  # Update Master Orchestration
    - check_claude_md_age()     # Check if CLAUDE.md is stale
    - run_cycle()               # Execute monitoring cycle
    - signal_handler()          # Handle shutdown signals
    - run()                     # Main run loop
```

### Data Flow
1. Monitor .cursor/rules directory
2. Detect file changes (new, modified, deleted)
3. Check CLAUDE.md age
4. Trigger smart context optimizer
5. Update Master Orchestration Agent
6. Log all activities

### Libraries Used
- **os**: Operating system interface
- **time**: Time-related functions
- **subprocess**: Subprocess management
- **signal**: Signal handling
- **sys**: System-specific parameters
- **pathlib**: Object-oriented filesystem paths
- **datetime**: Date and time handling
- **json**: JSON data interchange

## Integration Points

### Input Sources
- **mdc_files**: All .mdc files in .cursor/rules directory
- **claude_md**: Current CLAUDE.md file
- **domain_contexts**: .claude/contexts/ directory

### Output Destinations
- **updated_claude_md**: Refreshed CLAUDE.md with current MDC information
- **updated_master_orchestration**: Updated MasterOrchestrationAgent.mdc
- **log_file**: background_mdc_agent.log with activity timestamps

## Usage & Execution

### Start/Stop Commands
```bash
# Start Background MDC Agent
./start_background_mdc_agent.sh

# Stop Background MDC Agent
./stop_background_mdc_agent.sh

# Check agent status
ps aux | grep background_mdc_agent

# View agent logs
tail -f zmart-api/background_mdc_agent.log
```

### Location
- **File**: `zmart-api/background_mdc_agent.py`
- **Start Script**: `start_background_mdc_agent.sh`
- **Stop Script**: `stop_background_mdc_agent.sh`
- **Execution**: Project root directory
- **Permissions**: Read access to MDC files, write access to CLAUDE.md and logs

### Expected Output
```
üöÄ Starting Background MDC Agent...
‚úÖ Background MDC Agent started with PID: XXXXX
üìù Log file: zmart-api/background_mdc_agent.log
üîÑ Monitoring MDC files every 5 minutes...
```

## Error Handling

### File Errors
- Graceful handling of missing files and permissions
- Fallback behavior when directories don't exist
- Clear error messages for troubleshooting

### Process Errors
- Subprocess execution error handling
- Automatic retry on failures
- Graceful degradation when services unavailable

### Signal Handling
- Graceful shutdown on SIGINT/SIGTERM
- Proper cleanup of resources
- PID file management

### Retry Logic
- Automatic retry on failures with exponential backoff
- Maximum retry attempts to prevent infinite loops
- Error logging for debugging

## Monitoring & Success Indicators

### Success Indicators
- Regular log entries every 5 minutes
- Successful CLAUDE.md updates
- Successful Master Orchestration updates
- No error messages in logs
- Proper PID file management

### Failure Indicators
- Missing log entries
- Error messages in logs
- Failed subprocess executions
- Permission denied errors
- Stale PID files

## Health & Readiness
- **Liveness**: Process running and logging
- **Readiness**: Successfully monitoring MDC files
- **Timeouts**: 5-minute monitoring intervals

## Observability
- **Metrics**: Log entries with timestamps
- **Logs**: background_mdc_agent.log file
- **Dashboards**: Process status and log monitoring

## Orchestration & Ordering
- **Basic Integration**: N/A (standalone monitoring agent)
- **Master Agent Linked**: Yes (updates Master Orchestration Agent)
- **Ordering Hints**: Runs independently, triggers other services

## Performance & SLO (Initial)
- **Baseline p95 (ms)**: < 1000 (monitoring cycle)
- **Notes**: Lightweight monitoring with minimal resource usage

## Failure Modes & Runbooks
- **process-crash** ‚Äî Symptoms: Agent stops running, no log entries ‚Äî Remediation: Restart agent with start script, check logs for errors
- **file-permission-error** ‚Äî Symptoms: Cannot read MDC files or write logs ‚Äî Remediation: Check file permissions, verify directory access rights
- **subprocess-failure** ‚Äî Symptoms: Smart context optimizer or Master Orchestration updates failing ‚Äî Remediation: Check dependent services, verify Python environment, review error logs
- **stale-pid-file** ‚Äî Symptoms: PID file exists but process not running ‚Äî Remediation: Remove PID file, restart agent, check for zombie processes

## Rollback
- **Snapshot required**: No (monitoring agent)
- **Playbook**: N/A (monitoring agent)

## Load Balancing
- **Enabled**: No (single monitoring agent)
- **Pool**: N/A (monitoring agent)

## Known Issues
- None recorded

## Changelog
- 1.0.0 (2025-08-25): Initial background monitoring agent with automatic MDC updates




## Service Connections & Dependencies

### Current Active Connections
- ****** ‚úÖ **ACTIVE** - dependency connection
- **update_master_orchestration** ‚úÖ **ACTIVE** - dependency connection
- ****** ‚úÖ **ACTIVE** - dependency connection

### Potential Connections
- **update-master-orchestration** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and update-master-orchestration - Strong synergy opportunity (Confidence: 100%)
- **orchestration_learning_summary** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and orchestration_learning_summary - Strong synergy opportunity (Confidence: 100%)
- **MDCOrchestrationAgent** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and MDCOrchestrationAgent - Strong synergy opportunity (Confidence: 100%)
- **MasterOrchestrationAgent** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and MasterOrchestrationAgent - Strong synergy opportunity (Confidence: 100%)
- **MDCAgent** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and MDCAgent - Strong synergy opportunity (Confidence: 100%)

### Priority Connections
*Will be populated automatically during Phase 4 if service qualifies for top 10 priority services*

### Connection Summary
- **Current Active**: 3
- **Potential**: 5  
- **Priority**: 0
- **Total Discovered**: 3
- **Last Discovery Scan**: Auto-updated on system initialization
- **Discovery Method**: Multi-phase automated analysis with diamond pattern extraction
- **Update Policy**: Real-time updates during workflow execution
## üìÑ Additional Content from background_mdc_agent.mdc
# background_mdc_agent.mdc
> Type: backend | Version: 1.0.0 | Owner: zmartbot | Port: None

## Purpose
Background MDC Agent for Cursor
Automatically monitors and updates MDC files and CLAUDE.md

## Overview
Auto-discovered service managed by MDC-Dashboard system. This service was identified during automated system scanning and requires manual review and enhancement.

## Critical Functions
- Auto-discovered service functionality (requires manual documentation)
- Service integration with ZmartBot ecosystem

## Architecture & Integration
- **Service Type:** backend
- **Dependencies:** To be determined
- **Env Vars:** To be determined  
- **Lifecycle:** start=`python3 /Users/dansidanutz/Desktop/ZmartBot/zmart-api/system_backups/initial_startup_backup/system_backups/initial_startup_backup/background_mdc_agent.py.py` | stop=`pkill -f background_mdc_agent` | migrate=`n/a`

## API Endpoints
*Endpoints to be documented during manual review*

## Health & Readiness
- Liveness: To be configured
- Readiness: To be configured
- Timeouts: startup_grace=30s, http_timeout=30s

## Observability
- Metrics: To be configured
- Logs: format=python-logging
- Dashboards: To be created



## Service Connections & Dependencies

### Current Active Connections
- ****** ‚úÖ **ACTIVE** - dependency connection
- **update_master_orchestration** ‚úÖ **ACTIVE** - dependency connection
- ****** ‚úÖ **ACTIVE** - dependency connection

### Potential Connections
- **update-master-orchestration** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and update-master-orchestration - Strong synergy opportunity (Confidence: 100%)
- **orchestration_learning_summary** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and orchestration_learning_summary - Strong synergy opportunity (Confidence: 100%)
- **MDCOrchestrationAgent** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and MDCOrchestrationAgent - Strong synergy opportunity (Confidence: 100%)
- **MasterOrchestrationAgent** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and MasterOrchestrationAgent - Strong synergy opportunity (Confidence: 100%)
- **MDCAgent** ‚è≥ **POTENTIAL** - High-potential integration between background-mdc-agent and MDCAgent - Strong synergy opportunity (Confidence: 100%)

### Priority Connections
*Will be populated automatically during Phase 4 if service qualifies for top 10 priority services*

### Connection Summary
- **Current Active**: 3
- **Potential**: 5  
- **Priority**: 0
- **Total Discovered**: 3
- **Last Discovery Scan**: Auto-updated on system initialization
- **Discovery Method**: Multi-phase automated analysis with diamond pattern extraction
- **Update Policy**: Real-time updates during workflow execution
## Orchestration & Ordering
- Basic Integration: Enabled
- Master Agent Linked: No
- Ordering Hints: To be determined

## Performance & SLO
- Baseline p95 (ms): To be measured
- Notes: Auto-discovered service requiring performance baseline establishment

## Failure Modes & Runbooks
*To be documented during manual review*

## Rollback
- Snapshot required: To be determined
- Playbook: To be determined

## Load Balancing
- Enabled: To be determined
- Pool: To be determined

## Known Issues
- Auto-generated MDC file requiring manual review and enhancement
- Service functionality and dependencies need documentation

## Changelog
- 1.0.0 (2025-08-26): Auto-discovered service, MDC file generated by MDC-Dashboard system

---
*Auto-generated by MDC-Dashboard orphan service discovery on 2025-08-26*
description: Auto-discovered service requiring manual documentation
globs: ["/Users/dansidanutz/Desktop/ZmartBot/zmart-api/system_backups/initial_startup_backup/system_backups/initial_startup_backup/background_mdc_agent.py"]
alwaysApply: true
---

---
**Merge Summary**: Combined 2 files into unified MDC configuration
**Generated**: 2025-08-26T09:03:52.869838

## üìÑ Additional Content from background_mdc_agent.mdc
# background_mdc_agent.mdc
> Type: backend | Version: 1.0.0 | Owner: zmartbot | Port: None

## Purpose
Background MDC Agent for Cursor
Automatically monitors and updates MDC files and CLAUDE.md

## Overview
Auto-discovered service managed by MDC-Dashboard system. This service was identified during automated system scanning and requires manual review and enhancement.

## Critical Functions
- Auto-discovered service functionality (requires manual documentation)
- Service integration with ZmartBot ecosystem

## Architecture & Integration
- **Service Type:** backend
- **Dependencies:** To be determined
- **Env Vars:** To be determined  
- **Lifecycle:** start=`python3 /Users/dansidanutz/Desktop/ZmartBot/zmart-api/system_backups/initial_startup_backup/system_backups/initial_startup_backup/background_mdc_agent.py.py` | stop=`pkill -f background_mdc_agent` | migrate=`n/a`

## API Endpoints
*Endpoints to be documented during manual review*

## Health & Readiness
- Liveness: To be configured
- Readiness: To be configured
- Timeouts: startup_grace=30s, http_timeout=30s

## Observability
- Metrics: To be configured
- Logs: format=python-logging
- Dashboards: To be created



## Service Connections & Dependencies

### Current Active Connections
- ****** ‚úÖ **ACTIVE** - dependency connection

### Potential Connections
- **update-master-orchestration** ‚è≥ **POTENTIAL** - High-potential integration between background_mdc_agent and update-master-orchestration - Strong synergy opportunity (Confidence: 100%)
- **MDCOrchestrationAgent** ‚è≥ **POTENTIAL** - High-potential integration between background_mdc_agent and MDCOrchestrationAgent - Strong synergy opportunity (Confidence: 100%)
- **MasterOrchestrationAgent** ‚è≥ **POTENTIAL** - High-potential integration between background_mdc_agent and MasterOrchestrationAgent - Strong synergy opportunity (Confidence: 100%)
- **OrchestrationStartWorkflow** ‚è≥ **POTENTIAL** - High-potential integration between background_mdc_agent and OrchestrationStartWorkflow - Strong synergy opportunity (Confidence: 100%)
- **mdc-orchestration-agent** ‚è≥ **POTENTIAL** - High-potential integration between background_mdc_agent and mdc-orchestration-agent - Strong synergy opportunity (Confidence: 100%)

### Priority Connections
*Will be populated automatically during Phase 4 if service qualifies for top 10 priority services*

### Connection Summary
- **Current Active**: 1
- **Potential**: 5  
- **Priority**: 0
- **Total Discovered**: 1
- **Last Discovery Scan**: Auto-updated on system initialization
- **Discovery Method**: Multi-phase automated analysis with diamond pattern extraction
- **Update Policy**: Real-time updates during workflow execution
## Orchestration & Ordering
- Basic Integration: Enabled
- Master Agent Linked: No
- Ordering Hints: To be determined

## Performance & SLO
- Baseline p95 (ms): To be measured
- Notes: Auto-discovered service requiring performance baseline establishment

## Failure Modes & Runbooks
*To be documented during manual review*

## Rollback
- Snapshot required: To be determined
- Playbook: To be determined

## Load Balancing
- Enabled: To be determined
- Pool: To be determined

## Known Issues
- Auto-generated MDC file requiring manual review and enhancement
- Service functionality and dependencies need documentation

## Changelog
- 1.0.0 (2025-08-26): Auto-discovered service, MDC file generated by MDC-Dashboard system

---
*Auto-generated by MDC-Dashboard orphan service discovery on 2025-08-26*
description: Auto-discovered service requiring manual documentation
globs: ["/Users/dansidanutz/Desktop/ZmartBot/zmart-api/system_backups/initial_startup_backup/system_backups/initial_startup_backup/background_mdc_agent.py"]
alwaysApply: true
---

---
**Merge Summary**: Combined 2 files into unified MDC configuration
**Generated**: 2025-08-27T10:39:58.320471