# zmart-api.mdc
> Type: service | Version: 1.0.0 | Owner: zmartbot | Status: ACTIVE | Level: 2 | Port: 8000
Core service component of the ZmartBot ecosystem providing essential functionality.

# zmart-api.mdc
> Type: backend | Version: 1.0.0 | Owner: zmartbot | Port: 8000

## Overview
ZmartBot main API server providing trading, market data, and system management endpoints with comprehensive rate limiting, caching, and security features.

## Architecture & Integration
- **Service Type:** backend
- **Dependencies:** rate_limiting_service, cryptometer, kucoin, binance
- **Env Vars:** BINANCE_API_KEY, BINANCE_SECRET, KUCOIN_API_KEY, KUCOIN_SECRET, CRYPTOMETER_API_KEY
- **Lifecycle:** start=`python3 start_backend_safe.py` | stop=`pkill -f start_backend_safe` | migrate=`n/a`

## API Endpoints

### GET /api/v1/trading/accounts
- Summary: Get trading account information
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: Account balance and trading permissions
  - 401: Authentication failed
  - 429: Rate limit exceeded

### GET /api/v1/trading/positions
- Summary: Get current trading positions
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: List of active positions with PnL
  - 401: Authentication failed

### POST /api/v1/trading/orders
- Summary: Place new trading order
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{"symbol": "string", "side": "BUY|SELL", "quantity": "float", "order_type": "MARKET|LIMIT", "price": "float?"}`
- Responses:
  - 200: Order confirmation with order ID
  - 400: Invalid order parameters
  - 401: Authentication failed

### GET /api/v1/market-data/{symbol}
- Summary: Get market data for symbol
- Auth Required: No
- Request:
  - Params: `{"symbol": "string"}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: Real-time market data
  - 404: Symbol not found

### GET /api/v1/cryptometer/analysis
- Summary: Get Cryptometer technical analysis
- Auth Required: No
- Request:
  - Params: `{}`
  - Query: `{"symbol": "string", "timeframe": "string"}`
  - Body: `{}`
- Responses:
  - 200: Technical analysis data
  - 400: Invalid parameters

### GET /api/v1/riskmetric/bands
- Summary: Get RiskMetric risk bands
- Auth Required: No
- Request:
  - Params: `{}`
  - Query: `{"symbol": "string"}`
  - Body: `{}`
- Responses:
  - 200: Risk band data
  - 404: Symbol not found

### GET /api/v1/futures-symbols/{exchange}/available
- Summary: Get available futures symbols
- Auth Required: No
- Request:
  - Params: `{"exchange": "kucoin|binance"}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: List of available symbols
  - 400: Invalid exchange

### GET /api/v1/my-symbols
- Summary: Get user's portfolio symbols
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: Portfolio symbols data
  - 401: Authentication failed

### POST /api/v1/my-symbols
- Summary: Update user's portfolio symbols
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{"symbols": ["string"]}`
- Responses:
  - 200: Portfolio updated successfully
  - 400: Invalid symbols
  - 401: Authentication failed

### GET /api/v1/alerts
- Summary: Get trading alerts
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{}`
- Responses:
  - 200: List of active alerts
  - 401: Authentication failed

### POST /api/v1/alerts
- Summary: Create new trading alert
- Auth Required: Yes
- Request:
  - Params: `{}`
  - Query: `{}`
  - Body: `{"symbol": "string", "condition": "string", "price": "float", "action": "string"}`
- Responses:
  - 200: Alert created successfully
  - 400: Invalid alert parameters
  - 401: Authentication failed


## Triggers
- **API endpoint requests**
- **Database events**
- **Workflow transitions**

## Health & Readiness
- Liveness: `/health`
- Readiness: `/ready`
- Timeouts: startup_grace=30s, http_timeout=30s

## Observability
- Metrics: `/metrics`
- Logs: format=jsonl
- Dashboards: API Performance, Trading Metrics

## Orchestration & Ordering
- Basic Integration: Enabled
- Master Agent Linked: Yes
- Ordering Hints: rate_limiting_service ‚Üí OfficialBackend

## Performance & SLO (Initial)
- Baseline p95 (ms): 200
- Notes: Handles all API requests with rate limiting and caching

## Failure Modes & Runbooks
- **rate-limit-exceeded** ‚Äî Symptoms: 429 responses, API delays ‚Äî Remediation: Implement exponential backoff, reduce request frequency
- **database-connection-failed** ‚Äî Symptoms: Database errors, service unavailable ‚Äî Remediation: Check database connectivity, restart service
- **memory-exhaustion** ‚Äî Symptoms: High memory usage, service crashes ‚Äî Remediation: Monitor memory usage, implement cleanup

## Rollback
- Snapshot required: Yes
- Playbook: isolate ‚Üí restore_latest_snapshot ‚Üí verify ‚Üí reactivate

## Load Balancing
- Enabled: Yes
- Pool: api_pool

## Known Issues
- None recorded

## Changelog
- 1.0.0 (2025-08-24): Initial comprehensive API server with all trading endpoints




## Service Connections & Dependencies

### Current Active Connections
- **port-8000** ‚úÖ **ACTIVE** - network connection
- ****** ‚úÖ **ACTIVE** - dependency connection
- **cryptometer** ‚úÖ **ACTIVE** - dependency connection
- **kucoin** ‚úÖ **ACTIVE** - dependency connection
- **binance** ‚úÖ **ACTIVE** - dependency connection

### Potential Connections
- **MainAPIServer** ‚è≥ **POTENTIAL** - High-potential integration between OfficialBackend and MainAPIServer - Strong synergy opportunity (Confidence: 100%)
- **21indicatorsDatabase** ‚è≥ **POTENTIAL** - High-potential integration between OfficialBackend and 21indicatorsDatabase - Strong synergy opportunity (Confidence: 100%)
- **MySymbolsDatabase** ‚è≥ **POTENTIAL** - High-potential integration between OfficialBackend and MySymbolsDatabase - Strong synergy opportunity (Confidence: 100%)
- **api-keys-manager-service** ‚è≥ **POTENTIAL** - High-potential integration between OfficialBackend and api-keys-manager-service - Strong synergy opportunity (Confidence: 100%)
- **kingfisher-api** ‚è≥ **POTENTIAL** - High-potential integration between OfficialBackend and kingfisher-api - Strong synergy opportunity (Confidence: 100%)

### Priority Connections
- **optimization-target-7** üî• **PRIORITY #7** - Top #7 priority for system optimization - Score: 1.85 - Score: 1.00
  - **Optimization Impact**: 0.85
  - **Priority Score**: 0.50

### Connection Summary
- **Current Active**: 5
- **Potential**: 5  
- **Priority**: 1
- **Total Discovered**: 11
- **Last Discovery Scan**: Auto-updated on system initialization
- **Discovery Method**: Multi-phase automated analysis with diamond pattern extraction
- **Update Policy**: Real-time updates during workflow execution


## Requirements
- ‚úÖ **Unique port assignment**
- ‚úÖ **Database connectivity**
- ‚úÖ **Complete MDC documentation**
- ‚úÖ **Health endpoint implementation**
- ‚úÖ **Master Orchestration integration**
