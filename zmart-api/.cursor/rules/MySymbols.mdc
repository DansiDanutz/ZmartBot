
## Description
Core service component of the ZmartBot ecosystem providing essential functionality.

@agent: SymbolValidator

## ðŸ¤– MCP (Model Context Protocol) Integration

### **MCP Server Pairing**
**Status**: âœ… **ACTIVE** - MySymbols MCP Integration
**MCP Servers**: `claude-code`, `byterover`, `ui-tars`, `figma`, `supabase`
**Configuration**: `/Users/dansidanutz/.cursor/mcp.json`
**Integration Type**: Multi-MCP Service Integration

### **MCP Integration Features**
- **Claude Code Integration**: AI-powered symbol management and optimization
- **Memory Gateway**: Persistent symbol state and metadata
- **UI Automation**: Automated symbol monitoring and health checks
- **Figma Integration**: Symbol dashboard design and UI management
- **Supabase Integration**: Cloud-based symbol analytics and reporting

### **MCP Integration Benefits**
- **Enhanced Management**: AI-powered symbol management and optimization
- **Persistent State**: Cross-session symbol state and configuration management
- **Automated Monitoring**: Real-time symbol health and performance tracking
- **Visual Dashboard**: Interactive symbol management and testing interface
- **Cloud Analytics**: Comprehensive symbol usage and performance analytics

### **MCP Usage Examples**
```bash
# Health check via MCP
curl -X GET "http://127.0.0.1:8000/symbols/health"

# Symbol management via MCP
curl -X POST "http://127.0.0.1:8000/symbols/manage" -d '{"action": "update_portfolio"}'
```

### **MCP Status**
- **Claude Code**: âœ… Active - AI-powered symbol management
- **ByteRover**: âœ… Active - Persistent symbol state management
- **UI TARS**: âœ… Active - Automated symbol monitoring
- **Figma**: âœ… Active - Symbol dashboard design
- **Supabase**: âœ… Active - Cloud-based symbol analytics

---

# MySymbols - Trading Symbol Management System

## Overview
**MySymbols** represents the **core trading portfolio** of the ZmartBot project, consisting of a **maximum of 10 symbols** selected from Binance and KuCoin Future markets. These symbols are the **only ones traded, receiving alerts, and under continuous watch** by the system.

## Symbol Selection Criteria

### **Exchange Requirements**
- **Binance Futures**: Must be available on Binance Futures market
- **KuCoin Futures**: Must be available on KuCoin Futures market
- **Cross-Exchange**: Symbols must exist on both exchanges for arbitrage opportunities
- **Liquidity**: High trading volume and liquidity requirements

### **Symbol Validation**
```python
def validate_symbol_for_mysymbols(symbol):
    """Validate symbol for MySymbols inclusion"""
    # Check Binance Futures availability
    binance_available = check_binance_futures(symbol)
    
    # Check KuCoin Futures availability
    kucoin_available = check_kucoin_futures(symbol)
    
    # Check liquidity requirements
    liquidity_ok = check_liquidity_requirements(symbol)
    
    # Check trading volume
    volume_ok = check_trading_volume(symbol)
    
    return binance_available and kucoin_available and liquidity_ok and volume_ok
```

## MySymbols Database Structure

### **Core Database**
- **Location**: `src/data/my_symbols.db`
- **Type**: SQLite database
- **Purpose**: Store MySymbols with all indicators and market data
- **Max Symbols**: 10 symbols maximum

### **Database Schema**
```sql
-- MySymbols main table
CREATE TABLE my_symbols (
    id INTEGER PRIMARY KEY,
    symbol TEXT NOT NULL UNIQUE,
    exchange_binance BOOLEAN DEFAULT TRUE,
    exchange_kucoin BOOLEAN DEFAULT TRUE,
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status TEXT DEFAULT 'ACTIVE',
    priority INTEGER DEFAULT 0,
    description TEXT
);

-- Current market prices
CREATE TABLE symbol_prices (
    id INTEGER PRIMARY KEY,
    symbol_id INTEGER,
    price REAL NOT NULL,
    change_24h REAL,
    volume_24h REAL,
    high_24h REAL,
    low_24h REAL,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (symbol_id) REFERENCES my_symbols(id)
);

-- Technical indicators
CREATE TABLE symbol_indicators (
    id INTEGER PRIMARY KEY,
    symbol_id INTEGER,
    indicator_name TEXT NOT NULL,
    indicator_value REAL,
    indicator_data JSON,
    timeframe TEXT DEFAULT '1h',
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (symbol_id) REFERENCES my_symbols(id)
);

-- Alert history
CREATE TABLE symbol_alerts (
    id INTEGER PRIMARY KEY,
    symbol_id INTEGER,
    alert_type TEXT NOT NULL,
    alert_message TEXT,
    alert_value REAL,
    triggered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    acknowledged BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (symbol_id) REFERENCES my_symbols(id)
);
```

## Dynamic Symbol Management & Service Impact

### **Database-Driven Dynamic Changes**
The MySymbols system is **dynamically driven by the MySymbolsDatabase**, and any changes to the symbol portfolio have **major impacts on all system services**. When symbols are added, replaced, or deleted, the entire system architecture must adapt to maintain consistency and functionality.

### **Service Impact Overview**
```python
class MySymbolsServiceImpact:
    """Manages the impact of symbol changes on all system services"""
    
    def __init__(self):
        self.affected_services = [
            '21indicators_database',
            'live_alerts_system', 
            'technical_analysis',
            'market_data_collection',
            'frontend_components',
            'trading_systems',
            'master_orchestration_agent'
        ]
    
    def assess_symbol_change_impact(self, action, symbol, old_symbol=None):
        """Assess the impact of symbol changes across all services"""
        impact_report = {
            'action': action,  # 'ADD', 'REPLACE', 'DELETE'
            'symbol': symbol,
            'old_symbol': old_symbol,
            'timestamp': datetime.now(),
            'services_affected': [],
            'impact_level': 'HIGH',
            'requires_coordination': True
        }
        
        for service in self.affected_services:
            impact_report['services_affected'].append({
                'service': service,
                'impact': self.get_service_impact(service, action),
                'update_required': True,
                'priority': 'IMMEDIATE'
            })
        
        return impact_report
```

### **Add Symbol**
```python
def add_symbol_to_mysymbols(symbol, priority=0, description=""):
    """Add new symbol to MySymbols (max 10) with full service impact"""
    # Check current count
    current_count = get_mysymbols_count()
    
    if current_count >= 10:
        raise ValueError("Maximum 10 symbols allowed in MySymbols")
    
    # Validate symbol
    if not validate_symbol_for_mysymbols(symbol):
        raise ValueError(f"Symbol {symbol} does not meet requirements")
    
    # Assess service impact before adding
    impact_assessor = MySymbolsServiceImpact()
    impact_report = impact_assessor.assess_symbol_change_impact('ADD', symbol)
    
    # Add symbol to database
    query = """
    INSERT INTO my_symbols (symbol, priority, description)
    VALUES (?, ?, ?)
    """
    execute_query(query, (symbol, priority, description))
    
    # Initialize indicators
    initialize_symbol_indicators(symbol)
    
    # Trigger system-wide updates
    trigger_symbol_addition_updates(symbol, impact_report)
    
    return True

def trigger_symbol_addition_updates(symbol, impact_report):
    """Trigger updates across all affected services when symbol is added"""
    
    # Update 21 Indicators Database
    update_21indicators_for_new_symbol(symbol)
    
    # Update Live Alerts System
    update_live_alerts_for_new_symbol(symbol)
    
    # Update Technical Analysis Services
    update_technical_analysis_for_new_symbol(symbol)
    
    # Update Market Data Collection
    update_market_data_collection_for_new_symbol(symbol)
    
    # Update Frontend Components
    update_frontend_components_for_new_symbol(symbol)
    
    # Update Trading Systems
    update_trading_systems_for_new_symbol(symbol)
    
    # Notify Master Orchestration Agent
    notify_master_orchestration_symbol_change(symbol, 'ADDED', impact_report)
```

### **Remove Symbol**
```python
def remove_symbol_from_mysymbols(symbol):
    """Remove symbol from MySymbols with full service impact"""
    # Check if symbol exists
    if not symbol_exists_in_mysymbols(symbol):
        raise ValueError(f"Symbol {symbol} not found in MySymbols")
    
    # Assess service impact before removing
    impact_assessor = MySymbolsServiceImpact()
    impact_report = impact_assessor.assess_symbol_change_impact('DELETE', symbol)
    
    # Get symbol data before deletion
    symbol_data = get_symbol_data(symbol)
    symbol_id = get_symbol_id(symbol)
    
    # Trigger system-wide removal updates
    trigger_symbol_removal_updates(symbol, symbol_data, impact_report)
    
    # Delete related data
    delete_symbol_prices(symbol_id)
    delete_symbol_indicators(symbol_id)
    delete_symbol_alerts(symbol_id)
    
    # Delete symbol
    query = "DELETE FROM my_symbols WHERE symbol = ?"
    execute_query(query, (symbol,))
    
    return True

def trigger_symbol_removal_updates(symbol, symbol_data, impact_report):
    """Trigger updates across all affected services when symbol is removed"""
    
    # Remove from 21 Indicators Database
    remove_symbol_from_21indicators(symbol)
    
    # Remove from Live Alerts System
    remove_symbol_from_live_alerts(symbol)
    
    # Remove from Technical Analysis Services
    remove_symbol_from_technical_analysis(symbol)
    
    # Remove from Market Data Collection
    remove_symbol_from_market_data_collection(symbol)
    
    # Remove from Frontend Components
    remove_symbol_from_frontend_components(symbol)
    
    # Remove from Trading Systems
    remove_symbol_from_trading_systems(symbol)
    
    # Clean up historical data
    cleanup_symbol_historical_data(symbol)
    
    # Notify Master Orchestration Agent
    notify_master_orchestration_symbol_change(symbol, 'DELETED', impact_report)
```

### **Replace Symbol**
```python
def replace_symbol_in_mysymbols(old_symbol, new_symbol):
    """Replace symbol while maintaining data integrity and service coordination"""
    # Validate new symbol
    if not validate_symbol_for_mysymbols(new_symbol):
        raise ValueError(f"Symbol {new_symbol} does not meet requirements")
    
    # Assess service impact before replacing
    impact_assessor = MySymbolsServiceImpact()
    impact_report = impact_assessor.assess_symbol_change_impact('REPLACE', new_symbol, old_symbol)
    
    # Get old symbol data
    old_symbol_data = get_symbol_data(old_symbol)
    
    # Trigger system-wide replacement updates
    trigger_symbol_replacement_updates(old_symbol, new_symbol, old_symbol_data, impact_report)
    
    # Remove old symbol
    remove_symbol_from_mysymbols(old_symbol)
    
    # Add new symbol with same priority
    add_symbol_to_mysymbols(
        new_symbol, 
        priority=old_symbol_data['priority'],
        description=old_symbol_data['description']
    )
    
    return True

def trigger_symbol_replacement_updates(old_symbol, new_symbol, old_symbol_data, impact_report):
    """Trigger updates across all affected services when symbol is replaced"""
    
    # Replace in 21 Indicators Database
    replace_symbol_in_21indicators(old_symbol, new_symbol)
    
    # Replace in Live Alerts System
    replace_symbol_in_live_alerts(old_symbol, new_symbol)
    
    # Replace in Technical Analysis Services
    replace_symbol_in_technical_analysis(old_symbol, new_symbol)
    
    # Replace in Market Data Collection
    replace_symbol_in_market_data_collection(old_symbol, new_symbol)
    
    # Replace in Frontend Components
    replace_symbol_in_frontend_components(old_symbol, new_symbol)
    
    # Replace in Trading Systems
    replace_symbol_in_trading_systems(old_symbol, new_symbol)
    
    # Migrate historical data
    migrate_symbol_historical_data(old_symbol, new_symbol)
    
    # Notify Master Orchestration Agent
    notify_master_orchestration_symbol_change(new_symbol, 'REPLACED', impact_report, old_symbol)
```

## Indicator Management

### **21 Technical Indicators**
```python
INDICATORS = {
    "RSI": "Relative Strength Index",
    "MACD": "Moving Average Convergence Divergence",
    "BB": "Bollinger Bands",
    "EMA": "Exponential Moving Average",
    "SMA": "Simple Moving Average",
    "STOCH": "Stochastic Oscillator",
    "ATR": "Average True Range",
    "CCI": "Commodity Channel Index",
    "ADX": "Average Directional Index",
    "OBV": "On-Balance Volume",
    "VWAP": "Volume Weighted Average Price",
    "WILLIAMS_R": "Williams %R",
    "ROC": "Rate of Change",
    "MFI": "Money Flow Index",
    "DMI": "Directional Movement Index",
    "PARABOLIC_SAR": "Parabolic SAR",
    "AROON": "Aroon Indicator",
    "MOMENTUM": "Momentum Indicator",
    "TRIX": "TRIX Indicator",
    "ULTIMATE_OSCILLATOR": "Ultimate Oscillator",
    "KELTNER_CHANNEL": "Keltner Channel"
}
```

### **Indicator Updates**
```python
def update_symbol_indicators(symbol):
    """Update all indicators for a symbol"""
    symbol_id = get_symbol_id(symbol)
    
    for indicator_name in INDICATORS:
        # Calculate indicator value
        indicator_value = calculate_indicator(symbol, indicator_name)
        
        # Store in database
        query = """
        INSERT OR REPLACE INTO symbol_indicators 
        (symbol_id, indicator_name, indicator_value, timestamp)
        VALUES (?, ?, ?, CURRENT_TIMESTAMP)
        """
        execute_query(query, (symbol_id, indicator_name, indicator_value))
```

## Market Data Integration

### **Real-time Price Updates**
```python
def update_symbol_price(symbol):
    """Update current market price for symbol"""
    symbol_id = get_symbol_id(symbol)
    
    # Get price from both exchanges
    binance_price = get_binance_price(symbol)
    kucoin_price = get_kucoin_price(symbol)
    
    # Use weighted average or preferred exchange
    current_price = calculate_weighted_price(binance_price, kucoin_price)
    
    # Store price data
    query = """
    INSERT INTO symbol_prices 
    (symbol_id, price, change_24h, volume_24h, high_24h, low_24h)
    VALUES (?, ?, ?, ?, ?, ?)
    """
    execute_query(query, (symbol_id, current_price, change_24h, volume_24h, high_24h, low_24h))
```

### **Cross-Exchange Data**
```python
def get_cross_exchange_data(symbol):
    """Get data from both Binance and KuCoin"""
    return {
        "binance": {
            "price": get_binance_futures_price(symbol),
            "volume": get_binance_futures_volume(symbol),
            "open_interest": get_binance_open_interest(symbol)
        },
        "kucoin": {
            "price": get_kucoin_futures_price(symbol),
            "volume": get_kucoin_futures_volume(symbol),
            "open_interest": get_kucoin_open_interest(symbol)
        }
    }
```

## Alert System Integration

### **Symbol-Specific Alerts**
```python
def create_symbol_alert(symbol, alert_type, message, value=None):
    """Create alert for specific symbol"""
    symbol_id = get_symbol_id(symbol)
    
    query = """
    INSERT INTO symbol_alerts 
    (symbol_id, alert_type, alert_message, alert_value)
    VALUES (?, ?, ?, ?)
    """
    execute_query(query, (symbol_id, alert_type, message, value))
    
    # Trigger alert notification
    trigger_alert_notification(symbol, alert_type, message)
```

### **Alert Types**
```python
ALERT_TYPES = {
    "PRICE_BREAKOUT": "Price breakout above/below key levels",
    "INDICATOR_SIGNAL": "Technical indicator signals",
    "VOLUME_SPIKE": "Unusual volume activity",
    "LIQUIDATION_EVENT": "Large liquidation events",
    "RISK_ALERT": "Risk management alerts",
    "PATTERN_RECOGNITION": "Chart pattern recognition",
    "CROSS_SIGNAL": "Indicator cross-signals",
    "WIN_RATIO_UPDATE": "Win ratio analysis updates"
}
```

## Trading Integration

### **Exclusive Trading**
```python
def is_symbol_tradeable(symbol):
    """Check if symbol is in MySymbols and tradeable"""
    return symbol_exists_in_mysymbols(symbol) and get_symbol_status(symbol) == 'ACTIVE'
```

### **Portfolio Management**
```python
def get_mysymbols_portfolio():
    """Get current portfolio status for all MySymbols"""
    symbols = get_all_mysymbols()
    portfolio = {}
    
    for symbol in symbols:
        portfolio[symbol] = {
            "current_price": get_current_price(symbol),
            "indicators": get_all_indicators(symbol),
            "alerts": get_active_alerts(symbol),
            "position": get_current_position(symbol),
            "risk_score": calculate_risk_score(symbol)
        }
    
    return portfolio
```

## Database Queries

### **Get All MySymbols**
```sql
SELECT 
    symbol,
    exchange_binance,
    exchange_kucoin,
    status,
    priority,
    last_updated
FROM my_symbols
ORDER BY priority DESC, symbol;
```

### **Get Symbol with Indicators**
```sql
SELECT 
    m.symbol,
    m.status,
    i.indicator_name,
    i.indicator_value,
    i.timestamp
FROM my_symbols m
JOIN symbol_indicators i ON m.id = i.symbol_id
WHERE m.symbol = ?
ORDER BY i.timestamp DESC;
```

### **Get Symbol Alerts**
```sql
SELECT 
    alert_type,
    alert_message,
    alert_value,
    triggered_at,
    acknowledged
FROM symbol_alerts sa
JOIN my_symbols m ON sa.symbol_id = m.id
WHERE m.symbol = ?
ORDER BY triggered_at DESC;
```

## Service Impact Management

### **System-Wide Service Updates**
When MySymbols database changes occur, the following services are **automatically updated** to maintain system consistency:

#### **1. 21 Indicators Database Impact**
```python
def update_21indicators_for_new_symbol(symbol):
    """Update 21 Indicators Database when symbol is added"""
    # Add symbol to indicator snapshots
    # Initialize all 21 indicators for new symbol
    # Update pattern analysis tables
    # Update indicator history tracking

def remove_symbol_from_21indicators(symbol):
    """Remove symbol from 21 Indicators Database"""
    # Remove from indicator snapshots
    # Remove from pattern analysis
    # Clean up indicator history

def replace_symbol_in_21indicators(old_symbol, new_symbol):
    """Replace symbol in 21 Indicators Database"""
    # Update symbol references in all tables
    # Migrate indicator data
    # Update pattern analysis
```

#### **2. Live Alerts System Impact**
```python
def update_live_alerts_for_new_symbol(symbol):
    """Update Live Alerts System when symbol is added"""
    # Add symbol to alert monitoring
    # Initialize alert triggers for new symbol
    # Add to Messi, Pele, Maradona, Whale alert systems
    # Update alert history tracking

def remove_symbol_from_live_alerts(symbol):
    """Remove symbol from Live Alerts System"""
    # Remove from alert monitoring
    # Clean up alert triggers
    # Remove from special alerts
    # Clean up alert history

def replace_symbol_in_live_alerts(old_symbol, new_symbol):
    """Replace symbol in Live Alerts System"""
    # Update alert monitoring
    # Migrate alert triggers
    # Update special alerts systems
    # Migrate alert history
```

#### **3. Frontend Components Impact**
```python
def update_frontend_components_for_new_symbol(symbol):
    """Update Frontend Components when symbol is added"""
    # Add symbol card to dashboard
    # Initialize indicator cards for new symbol
    # Update symbol list in UI
    # Update market sentiment calculations
    # Update win rate ratio calculations

def remove_symbol_from_frontend_components(symbol):
    """Remove symbol from Frontend Components"""
    # Remove symbol card
    # Remove indicator cards
    # Update symbol list in UI
    # Update market sentiment calculations
    # Update win rate ratio calculations

def replace_symbol_in_frontend_components(old_symbol, new_symbol):
    """Replace symbol in Frontend Components"""
    # Replace symbol card
    # Update indicator cards
    # Update symbol list in UI
    # Update market sentiment
    # Update win rate ratio
```

#### **4. Trading Systems Impact**
```python
def update_trading_systems_for_new_symbol(symbol):
    """Update Trading Systems when symbol is added"""
    # Add symbol to trading portfolio
    # Initialize position tracking
    # Add to risk management system
    # Update trading signals

def remove_symbol_from_trading_systems(symbol):
    """Remove symbol from Trading Systems"""
    # Remove from trading portfolio
    # Clean up position tracking
    # Remove from risk management
    # Remove from trading signals

def replace_symbol_in_trading_systems(old_symbol, new_symbol):
    """Replace symbol in Trading Systems"""
    # Update trading portfolio
    # Migrate position tracking
    # Update risk management
    # Update trading signals
```

### **Master Orchestration Coordination**
```python
def notify_master_orchestration_symbol_change(symbol, action, impact_report, old_symbol=None):
    """Notify Master Orchestration Agent of symbol changes"""
    notification = {
        'action': action,  # 'ADDED', 'REPLACED', 'DELETED'
        'symbol': symbol,
        'old_symbol': old_symbol,
        'timestamp': datetime.now(),
        'impact_report': impact_report,
        'services_affected': impact_report['services_affected'],
        'requires_coordination': True,
        'priority': 'IMMEDIATE'
    }
    
    # Send notification to Master Orchestration Agent
    send_to_master_orchestration(notification)
    
    # Log symbol change for audit
    log_symbol_change(notification)
```

### **Impact Assessment & Monitoring**
```python
def monitor_symbol_change_impact(symbol, action):
    """Monitor the impact of symbol changes across all services"""
    impact_metrics = {
        'services_updated': 0,
        'services_failed': 0,
        'update_time': 0,
        'data_migrated': 0,
        'alerts_generated': 0
    }
    
    # Monitor each service update
    for service in ['21indicators', 'live_alerts', 'frontend', 'trading']:
        try:
            update_service_for_symbol_change(service, symbol, action)
            impact_metrics['services_updated'] += 1
        except Exception as e:
            impact_metrics['services_failed'] += 1
            log_service_update_failure(service, symbol, action, e)
    
    return impact_metrics
```

## Success Criteria

### **Symbol Management**
- âœ… Maximum 10 symbols maintained
- âœ… All symbols available on both exchanges
- âœ… Symbols meet liquidity requirements
- âœ… Cross-exchange validation successful
- âœ… **Dynamic database changes properly coordinated**

### **Data Management**
- âœ… All indicators updated regularly
- âœ… Market prices current and accurate
- âœ… Alert system integrated
- âœ… Database integrity maintained
- âœ… **Service impact properly managed**

### **Trading Integration**
- âœ… Only MySymbols are traded
- âœ… Alerts generated for MySymbols only
- âœ… Continuous monitoring active
- âœ… Portfolio management functional
- âœ… **System-wide coordination maintained**

### **Service Impact Management**
- âœ… All 7 services automatically updated on symbol changes
- âœ… Master Orchestration Agent properly notified
- âœ… Data migration handled correctly
- âœ… Service synchronization maintained
- âœ… Impact monitoring and logging active

The MySymbols system ensures that only the most suitable symbols from Binance and KuCoin Futures markets are traded, with comprehensive monitoring, alerting, and data management for optimal trading performance. **All symbol changes are dynamically coordinated across the entire system architecture to maintain consistency and functionality.**
description:
globs:
alwaysApply: true

## Requirements
- âœ… **Unique port assignment**
- âœ… **Database connectivity**
- âœ… **Master Orchestration integration**


---

## Triggers
- **Database events**
