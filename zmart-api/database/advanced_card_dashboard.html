<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZmartBot Advanced Card Dashboard</title>
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://unpkg.com/gridstack/dist/gridstack-all.js"></script>
    <link href="https://unpkg.com/gridstack/dist/gridstack.min.css" rel="stylesheet"/>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            
            --card-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            --card-shadow-hover: 0 25px 50px rgba(0, 0, 0, 0.15);
            --border-radius: 20px;
            --transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        /* Enhanced Glass Morphism Header */
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 25px;
            margin: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .control-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.3);
        }

        .control-button.danger { background: var(--danger-gradient); }
        .control-button.success { background: var(--success-gradient); }
        .control-button.warning { background: var(--warning-gradient); }

        /* Advanced Status Bar */
        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            margin: 0 20px 20px 20px;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 15px;
            font-weight: 600;
            transition: var(--transition);
            cursor: pointer;
        }

        .status-item:hover {
            transform: scale(1.05);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: flex;
            position: relative;
        }

        .status-connected {
            background: #4caf50;
            animation: pulse-green 2s infinite;
        }

        .status-syncing {
            background: #ff9800;
            animation: pulse-orange 1s infinite;
        }

        .status-error {
            background: #f44336;
            animation: pulse-red 1s infinite;
        }

        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
        }

        @keyframes pulse-orange {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 152, 0, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(255, 152, 0, 0); }
        }

        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); }
        }

        /* Advanced Card System */
        .dashboard-container {
            padding: 0 20px 20px 20px;
        }

        .card-controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .card-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-tag {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            font-weight: 500;
        }

        .filter-tag:hover,
        .filter-tag.active {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            transform: scale(1.05);
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 0;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: var(--transition);
            overflow: hidden;
            position: relative;
            cursor: grab;
        }

        .dashboard-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--card-shadow-hover);
        }

        .dashboard-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .card-header {
            background: var(--primary-gradient);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .card-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .card-action {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .card-action:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .card-content {
            padding: 25px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
        }

        /* Specialized Card Types */
        .metric-card .card-header { background: var(--success-gradient); }
        .chart-card .card-header { background: var(--primary-gradient); }
        .status-card .card-header { background: var(--warning-gradient); }
        .data-card .card-header { background: var(--dark-gradient); }
        .alert-card .card-header { background: var(--danger-gradient); }

        /* Advanced Metrics Display */
        .metric-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 20px 0;
        }

        .metric-value {
            font-size: 3rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            line-height: 1;
        }

        .metric-label {
            font-size: 1rem;
            color: #666;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .metric-change {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 5px 12px;
            border-radius: 15px;
        }

        .metric-change.positive {
            background: rgba(76, 175, 80, 0.1);
            color: #4caf50;
        }

        .metric-change.negative {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
        }

        .metric-change.neutral {
            background: rgba(158, 158, 158, 0.1);
            color: #9e9e9e;
        }

        /* Enhanced Charts */
        .chart-container {
            position: relative;
            height: 250px;
            margin: 15px 0;
            padding: 10px;
        }

        .chart-container canvas {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
        }

        /* Advanced Data Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            background: white;
        }

        .data-table thead {
            background: var(--primary-gradient);
            color: white;
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .data-table th {
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }

        .data-table tbody tr {
            transition: var(--transition);
        }

        .data-table tbody tr:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.01);
        }

        .data-table tbody tr:nth-child(even) {
            background: rgba(248, 249, 250, 0.8);
        }

        /* Progress Bars and Indicators */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 10px;
            transition: width 1s ease-in-out;
        }

        .health-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .health-excellent {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .health-good {
            background: rgba(139, 195, 74, 0.2);
            color: #8bc34a;
            border: 1px solid rgba(139, 195, 74, 0.3);
        }

        .health-fair {
            background: rgba(255, 152, 0, 0.2);
            color: #ff9800;
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        .health-poor {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        /* Real-time Activity Feed */
        .activity-feed {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .activity-item:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateX(5px);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .activity-icon.sync { background: var(--success-gradient); }
        .activity-icon.error { background: var(--danger-gradient); }
        .activity-icon.info { background: var(--primary-gradient); }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #666;
        }

        /* Interactive Search and Filters */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            font-size: 1rem;
            transition: var(--transition);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .search-input:focus {
            outline: none;
            background: white;
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 1.2rem;
        }

        /* Advanced Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: white;
            margin: 2% auto;
            padding: 0;
            border-radius: var(--border-radius);
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.5s cubic-bezier(0.23, 1, 0.320, 1);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: var(--primary-gradient);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            min-width: 300px;
            padding: 20px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: var(--transition);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: var(--success-gradient); }
        .notification.error { background: var(--danger-gradient); }
        .notification.warning { background: var(--warning-gradient); }
        .notification.info { background: var(--primary-gradient); }

        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px;
            text-align: center;
        }

        .loading-text {
            margin-top: 20px;
            color: #666;
            font-weight: 600;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .card-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .header {
                padding: 20px;
                margin: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .status-bar {
                grid-template-columns: 1fr;
                margin: 0 15px 15px 15px;
            }

            .dashboard-container {
                padding: 0 15px 15px 15px;
            }
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            .dashboard-card {
                background: rgba(30, 30, 30, 0.95);
                color: #fff;
            }

            .card-content {
                color: #fff;
            }

            .data-table {
                background: rgba(30, 30, 30, 0.95);
                color: #fff;
            }

            .search-input {
                background: rgba(30, 30, 30, 0.9);
                color: #fff;
            }
        }

        /* Custom Scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body>
    <!-- Enhanced Header with Advanced Controls -->
    <div class="header">
        <div>
            <h1>
                <i class="fas fa-database"></i>
                ZmartBot Advanced Analytics
            </h1>
        </div>
        
        <div class="header-controls">
            <button class="control-button" onclick="toggleRealTime()">
                <i class="fas fa-broadcast-tower"></i>
                <span id="realTimeStatus">Real-time OFF</span>
            </button>
            <button class="control-button success" onclick="triggerFullSync()">
                <i class="fas fa-cloud-upload-alt"></i>
                Full Sync
            </button>
            <button class="control-button warning" onclick="exportDashboard()">
                <i class="fas fa-download"></i>
                Export Data
            </button>
            <button class="control-button danger" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                Settings
            </button>
        </div>
    </div>

    <!-- Advanced Status Bar -->
    <div class="status-bar">
        <div class="status-item" onclick="showConnectionDetails()">
            <div class="status-indicator status-connected" id="dbStatus"></div>
            <div>
                <div style="font-size: 0.9rem;">Database Service</div>
                <div style="font-size: 0.8rem; opacity: 0.8;" id="dbStatusText">Connected</div>
            </div>
        </div>
        
        <div class="status-item" onclick="showCloudDetails()">
            <div class="status-indicator status-connected" id="cloudStatus"></div>
            <div>
                <div style="font-size: 0.9rem;">Supabase Cloud</div>
                <div style="font-size: 0.8rem; opacity: 0.8;" id="cloudStatusText">Connected</div>
            </div>
        </div>
        
        <div class="status-item" onclick="showSyncDetails()">
            <div class="status-indicator status-syncing" id="syncStatus"></div>
            <div>
                <div style="font-size: 0.9rem;">Last Sync</div>
                <div style="font-size: 0.8rem; opacity: 0.8;" id="syncStatusText">2 min ago</div>
            </div>
        </div>
        
        <div class="status-item" onclick="showSystemDetails()">
            <i class="fas fa-server"></i>
            <div>
                <div style="font-size: 0.9rem;">Active Databases</div>
                <div style="font-size: 0.8rem; opacity: 0.8;" id="activeDatabases">Loading...</div>
            </div>
        </div>
        
        <div class="status-item" onclick="showHealthDetails()">
            <i class="fas fa-heartbeat"></i>
            <div>
                <div style="font-size: 0.9rem;">System Health</div>
                <div style="font-size: 0.8rem; opacity: 0.8;" id="systemHealth">95%</div>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Advanced Card Controls -->
        <div class="card-controls">
            <div class="card-filter">
                <span style="color: white; font-weight: 600; margin-right: 15px;">Filter Cards:</span>
                <div class="filter-tag active" data-filter="all">All Cards</div>
                <div class="filter-tag" data-filter="metrics">Metrics</div>
                <div class="filter-tag" data-filter="charts">Charts</div>
                <div class="filter-tag" data-filter="tables">Tables</div>
                <div class="filter-tag" data-filter="health">Health</div>
                <div class="filter-tag" data-filter="activity">Activity</div>
            </div>
            
            <div class="search-container" style="max-width: 300px;">
                <input type="text" class="search-input" placeholder="Search cards..." id="cardSearch">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>

        <!-- Advanced Card Grid -->
        <div class="card-grid" id="cardGrid">
            
            <!-- Enhanced Metrics Cards -->
            <div class="dashboard-card metric-card" data-category="metrics">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-database"></i>
                        Total Databases
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="refreshDatabaseCount()">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="card-action" onclick="showDatabaseDetails()">
                            <i class="fas fa-info"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="metric-display">
                        <div class="metric-value" id="totalDatabases">0</div>
                        <div class="metric-label">Active Databases</div>
                        <div class="metric-change positive" id="dbChange">
                            <i class="fas fa-arrow-up"></i>
                            +2 this week
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%"></div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; color: #666;">
                        85% of target capacity
                    </div>
                </div>
            </div>

            <div class="dashboard-card metric-card" data-category="metrics">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Total Records
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="refreshRecordCount()">
                            <i class="fas fa-sync"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="metric-display">
                        <div class="metric-value" id="totalRecords">0</div>
                        <div class="metric-label">Database Records</div>
                        <div class="metric-change positive" id="recordChange">
                            <i class="fas fa-arrow-up"></i>
                            +1.2K today
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px;">
                        <div style="text-align: center; padding: 10px; background: rgba(76, 175, 80, 0.1); border-radius: 10px;">
                            <div style="font-weight: bold; color: #4caf50;">Level 3</div>
                            <div style="font-size: 0.8rem; color: #666;" id="level3Count">0</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(255, 193, 7, 0.1); border-radius: 10px;">
                            <div style="font-weight: bold; color: #ffc107;">Level 2</div>
                            <div style="font-size: 0.8rem; color: #666;" id="level2Count">0</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 10px;">
                            <div style="font-weight: bold; color: #667eea;">Level 1</div>
                            <div style="font-size: 0.8rem; color: #666;" id="level1Count">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card metric-card" data-category="health">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-heartbeat"></i>
                        System Health
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="runHealthCheck()">
                            <i class="fas fa-stethoscope"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="metric-display">
                        <div class="metric-value" id="avgHealth">0%</div>
                        <div class="metric-label">Average Health Score</div>
                        <div class="metric-change neutral" id="healthChange">
                            <i class="fas fa-minus"></i>
                            Stable
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 20px; gap: 10px;">
                        <div class="health-indicator health-excellent">
                            <i class="fas fa-check-circle"></i>
                            <span id="excellentCount">0</span> Excellent
                        </div>
                        <div class="health-indicator health-good">
                            <i class="fas fa-thumbs-up"></i>
                            <span id="goodCount">0</span> Good
                        </div>
                        <div class="health-indicator health-fair">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span id="fairCount">0</span> Fair
                        </div>
                        <div class="health-indicator health-poor">
                            <i class="fas fa-times-circle"></i>
                            <span id="poorCount">0</span> Poor
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card metric-card" data-category="metrics">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-hdd"></i>
                        Storage Usage
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="optimizeStorage()">
                            <i class="fas fa-compress-arrows-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="metric-display">
                        <div class="metric-value" id="totalSize">0 MB</div>
                        <div class="metric-label">Total Database Size</div>
                        <div class="metric-change positive" id="sizeChange">
                            <i class="fas fa-arrow-up"></i>
                            +12 MB today
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 10px;">
                            <span style="color: #666;">Storage Breakdown</span>
                            <span style="color: #667eea; font-weight: bold;" id="storageUsed">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 65%" id="storageProgress"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.8rem; color: #666;">
                            <span>Used: <span id="usedSpace">0 MB</span></span>
                            <span>Available: <span id="availableSpace">1000 MB</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Chart Cards -->
            <div class="dashboard-card chart-card" data-category="charts">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-pie"></i>
                        Database Categories
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="refreshCategoryChart()">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="card-action" onclick="exportChartData('category')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                        <div style="text-align: center; font-size: 0.9rem;">
                            <strong style="color: #667eea;">Service Lifecycle</strong>
                            <div id="serviceLifecycleCount">0</div>
                        </div>
                        <div style="text-align: center; font-size: 0.9rem;">
                            <strong style="color: #f093fb;">Trading Data</strong>
                            <div id="tradingDataCount">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card chart-card" data-category="charts">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-area"></i>
                        Health Distribution
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="refreshHealthChart()">
                            <i class="fas fa-sync"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="healthChart"></canvas>
                    </div>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="color: #666; font-size: 0.9rem;">Health Trend</span>
                            <span style="color: #4caf50; font-weight: bold;">↗ Improving</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 88%; background: linear-gradient(90deg, #f44336, #ff9800, #8bc34a, #4caf50);"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card chart-card" data-category="charts">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-chart-line"></i>
                        Activity Timeline
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="refreshActivityChart()">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="card-action" onclick="showFullTimeline()">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="chart-container">
                        <canvas id="activityChart"></canvas>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 15px; text-align: center;">
                        <div>
                            <div style="font-weight: bold; color: #667eea;" id="todaySyncs">0</div>
                            <div style="font-size: 0.8rem; color: #666;">Today</div>
                        </div>
                        <div>
                            <div style="font-weight: bold; color: #f093fb;" id="weekSyncs">0</div>
                            <div style="font-size: 0.8rem; color: #666;">This Week</div>
                        </div>
                        <div>
                            <div style="font-weight: bold; color: #4caf50;" id="monthSyncs">0</div>
                            <div style="font-size: 0.8rem; color: #666;">This Month</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Service Lifecycle Cards -->
            <div class="dashboard-card status-card" data-category="tables">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-search"></i>
                        Discovery Registry
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="refreshDiscoveryData()">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="card-action" onclick="showDiscoveryDetails()">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="metric-display">
                        <div class="metric-value" id="discoveryServices">0</div>
                        <div class="metric-label">Discovered Services</div>
                        <div class="metric-change positive">
                            <i class="fas fa-plus"></i>
                            Level 1 Services
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Service Type</th>
                                    <th>Count</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="discoveryTableBody">
                                <tr>
                                    <td>API Services</td>
                                    <td id="apiServicesCount">0</td>
                                    <td><span class="health-indicator health-excellent">Active</span></td>
                                </tr>
                                <tr>
                                    <td>Background Tasks</td>
                                    <td id="backgroundTasksCount">0</td>
                                    <td><span class="health-indicator health-good">Monitored</span></td>
                                </tr>
                                <tr>
                                    <td>Utilities</td>
                                    <td id="utilitiesCount">0</td>
                                    <td><span class="health-indicator health-fair">Pending</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="dashboard-card status-card" data-category="tables">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-id-card"></i>
                        Passport Registry
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="refreshPassportData()">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="card-action" onclick="showPassportDetails()">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="metric-display">
                        <div class="metric-value" id="passportServices">0</div>
                        <div class="metric-label">Services with Passports</div>
                        <div class="metric-change positive">
                            <i class="fas fa-shield-alt"></i>
                            Level 2 Services
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div style="padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;" id="activePassports">0</div>
                                <div style="font-size: 0.8rem; color: #666;">Active Passports</div>
                            </div>
                            <div style="padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 10px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #4caf50;" id="validPassports">0</div>
                                <div style="font-size: 0.8rem; color: #666;">Valid Passports</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 5px;">
                                <span style="color: #666; font-size: 0.9rem;">Passport Validity</span>
                                <span style="color: #4caf50; font-weight: bold;">98%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 98%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card status-card" data-category="tables">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-award"></i>
                        Service Registry
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="refreshServiceData()">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="card-action" onclick="showServiceDetails()">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="metric-display">
                        <div class="metric-value" id="registeredServices">0</div>
                        <div class="metric-label">Certified Services</div>
                        <div class="metric-change positive">
                            <i class="fas fa-certificate"></i>
                            Level 3 Services
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                            <div style="padding: 10px; background: rgba(76, 175, 80, 0.1); border-radius: 8px; text-align: center;">
                                <div style="font-weight: bold; color: #4caf50;" id="productionServices">0</div>
                                <div style="font-size: 0.7rem; color: #666;">Production</div>
                            </div>
                            <div style="padding: 10px; background: rgba(255, 193, 7, 0.1); border-radius: 8px; text-align: center;">
                                <div style="font-weight: bold; color: #ffc107;" id="stagingServices">0</div>
                                <div style="font-size: 0.7rem; color: #666;">Staging</div>
                            </div>
                            <div style="padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; text-align: center;">
                                <div style="font-weight: bold; color: #667eea;" id="developmentServices">0</div>
                                <div style="font-size: 0.7rem; color: #666;">Development</div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 92%"></div>
                        </div>
                        <div style="text-align: center; margin-top: 10px; color: #666; font-size: 0.9rem;">
                            92% Service Certification Rate
                        </div>
                    </div>
                </div>
            </div>

            <!-- Real-time Activity Feed -->
            <div class="dashboard-card alert-card" data-category="activity">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-stream"></i>
                        Real-time Activity
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="pauseActivity()">
                            <i class="fas fa-pause" id="activityToggle"></i>
                        </button>
                        <button class="card-action" onclick="clearActivity()">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="activity-feed" id="activityFeed">
                        <div class="activity-item">
                            <div class="activity-icon sync">
                                <i class="fas fa-sync"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Database sync completed</div>
                                <div class="activity-time">2 minutes ago</div>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-icon info">
                                <i class="fas fa-info"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">New service discovered</div>
                                <div class="activity-time">5 minutes ago</div>
                            </div>
                        </div>
                        
                        <div class="activity-item">
                            <div class="activity-icon sync">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Health check passed</div>
                                <div class="activity-time">8 minutes ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Performing Databases -->
            <div class="dashboard-card data-card" data-category="tables">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-trophy"></i>
                        Top Performers
                    </div>
                    <div class="card-actions">
                        <button class="card-action" onclick="refreshTopPerformers()">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="card-action" onclick="showAllDatabases()">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Database</th>
                                    <th>Health</th>
                                    <th>Records</th>
                                </tr>
                            </thead>
                            <tbody id="topPerformersBody">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Enhanced Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Details</h2>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Modal content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const SUPABASE_URL = 'https://asjtxrmftmutcsnqgidy.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFzanR4cm1mdG11dGNzbnFnaWR5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk1Nzc4NjgsImV4cCI6MjA2NTE1Mzg2OH0.ScIz31CxgxC2Knya-oHtMw5GQ7QL4QUHky-cEUdqpFM';
        const DATABASE_SERVICE_URL = 'http://127.0.0.1:8900';

        // Global variables
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let charts = {};
        let dashboardData = {};
        let realTimeMode = false;
        let activityPaused = false;

        // Initialize Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
            setupCardFilters();
            setupDragAndDrop();
            startRealTimeUpdates();
        });

        async function initializeDashboard() {
            showNotification('Initializing Advanced Dashboard...', 'info');
            
            try {
                await refreshAllData();
                createAllCharts();
                startActivitySimulation();
                showNotification('Dashboard loaded successfully!', 'success');
            } catch (error) {
                console.error('Dashboard initialization error:', error);
                showNotification('Error loading dashboard: ' + error.message, 'error');
            }
        }

        function setupEventListeners() {
            // Real-time toggle
            window.toggleRealTime = function() {
                realTimeMode = !realTimeMode;
                const statusBtn = document.getElementById('realTimeStatus');
                if (realTimeMode) {
                    statusBtn.textContent = 'Real-time ON';
                    showNotification('Real-time mode enabled', 'success');
                } else {
                    statusBtn.textContent = 'Real-time OFF';
                    showNotification('Real-time mode disabled', 'info');
                }
            };

            // Card search
            document.getElementById('cardSearch').addEventListener('input', function(e) {
                filterCards(e.target.value);
            });

            // Modal close
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('detailModal');
                if (event.target === modal) {
                    closeModal();
                }
            });
        }

        function setupCardFilters() {
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    // Update active state
                    document.querySelectorAll('.filter-tag').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Filter cards
                    const filter = this.dataset.filter;
                    filterCardsByCategory(filter);
                });
            });
        }

        function setupDragAndDrop() {
            // Make cards draggable
            const cardGrid = document.getElementById('cardGrid');
            new Sortable(cardGrid, {
                animation: 150,
                ghostClass: 'dragging',
                onEnd: function(evt) {
                    showNotification('Card layout updated', 'info');
                    saveLayoutToStorage();
                }
            });
        }

        async function refreshAllData() {
            try {
                // Fetch data from multiple sources
                const [localData, cloudData] = await Promise.all([
                    fetchLocalData(),
                    fetchCloudData()
                ]);

                dashboardData = { local: localData, cloud: cloudData };

                // Update all UI components
                updateAllMetrics();
                updateStatusIndicators();
                updateTopPerformers();
                
                if (Object.keys(charts).length > 0) {
                    updateAllCharts();
                }

            } catch (error) {
                console.error('Error refreshing data:', error);
                showNotification('Error refreshing data: ' + error.message, 'error');
            }
        }

        async function fetchLocalData() {
            try {
                const response = await fetch(`${DATABASE_SERVICE_URL}/api/system/overview`);
                return response.ok ? await response.json() : null;
            } catch (error) {
                console.error('Local data fetch failed:', error);
                return null;
            }
        }

        async function fetchCloudData() {
            try {
                const { data, error } = await supabase
                    .from('database_registry')
                    .select('*')
                    .order('updated_at', { ascending: false });
                
                return error ? [] : data;
            } catch (error) {
                console.error('Cloud data fetch failed:', error);
                return [];
            }
        }

        function updateAllMetrics() {
            const stats = dashboardData.local?.database_statistics || {};
            const lifecycle = dashboardData.local?.service_lifecycle || {};
            const cloudData = dashboardData.cloud || [];

            // Update metric displays
            updateMetricValue('totalDatabases', cloudData.length || stats.total_databases || 0);
            updateMetricValue('totalRecords', (stats.total_records || 0).toLocaleString());
            updateMetricValue('avgHealth', `${(stats.average_health || 0).toFixed(1)}%`);
            updateMetricValue('totalSize', `${(stats.total_size_mb || 0).toFixed(1)} MB`);

            // Update service lifecycle metrics
            updateMetricValue('discoveryServices', lifecycle.discovery_services || 0);
            updateMetricValue('passportServices', lifecycle.passport_services || 0);
            updateMetricValue('registeredServices', lifecycle.registered_services || 0);

            // Update breakdown counts
            updateMetricValue('level1Count', lifecycle.discovery_services || 0);
            updateMetricValue('level2Count', lifecycle.passport_services || 0);
            updateMetricValue('level3Count', lifecycle.registered_services || 0);

            // Update health distribution
            updateHealthDistribution(cloudData);
        }

        function updateMetricValue(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                // Add animation effect
                element.style.transform = 'scale(1.1)';
                element.textContent = value;
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                }, 200);
            }
        }

        function updateHealthDistribution(cloudData) {
            const distribution = { excellent: 0, good: 0, fair: 0, poor: 0 };

            cloudData.forEach(db => {
                const score = db.health_score || 0;
                if (score >= 90) distribution.excellent++;
                else if (score >= 75) distribution.good++;
                else if (score >= 50) distribution.fair++;
                else distribution.poor++;
            });

            updateMetricValue('excellentCount', distribution.excellent);
            updateMetricValue('goodCount', distribution.good);
            updateMetricValue('fairCount', distribution.fair);
            updateMetricValue('poorCount', distribution.poor);
        }

        function updateStatusIndicators() {
            const dbStatus = dashboardData.local ? 'status-connected' : 'status-error';
            const cloudStatus = dashboardData.cloud ? 'status-connected' : 'status-error';
            
            document.getElementById('dbStatus').className = `status-indicator ${dbStatus}`;
            document.getElementById('cloudStatus').className = `status-indicator ${cloudStatus}`;
            
            document.getElementById('dbStatusText').textContent = dashboardData.local ? 'Connected' : 'Disconnected';
            document.getElementById('cloudStatusText').textContent = dashboardData.cloud ? 'Connected' : 'Disconnected';
            document.getElementById('activeDatabases').textContent = (dashboardData.cloud?.length || 0).toString();
        }

        function createAllCharts() {
            createCategoryChart();
            createHealthChart();
            createActivityChart();
        }

        function createCategoryChart() {
            const cloudData = dashboardData.cloud || [];
            if (cloudData.length === 0) return;

            const categoryCount = {};
            cloudData.forEach(db => {
                const category = db.category || 'unknown';
                categoryCount[category] = (categoryCount[category] || 0) + 1;
            });

            const ctx = document.getElementById('categoryChart');
            if (!ctx) return;

            if (charts.categoryChart) charts.categoryChart.destroy();

            const colors = [
                'rgba(102, 126, 234, 0.8)',
                'rgba(240, 147, 251, 0.8)',
                'rgba(245, 87, 108, 0.8)',
                'rgba(79, 172, 254, 0.8)',
                'rgba(67, 233, 123, 0.8)',
                'rgba(254, 215, 102, 0.8)'
            ];

            charts.categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryCount),
                    datasets: [{
                        data: Object.values(categoryCount),
                        backgroundColor: colors,
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: { size: 12, weight: '600' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            cornerRadius: 10,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.raw / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.raw} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createHealthChart() {
            const cloudData = dashboardData.cloud || [];
            if (cloudData.length === 0) return;

            const healthDistribution = { 'Excellent': 0, 'Good': 0, 'Fair': 0, 'Poor': 0 };

            cloudData.forEach(db => {
                const score = db.health_score || 0;
                if (score >= 90) healthDistribution.Excellent++;
                else if (score >= 75) healthDistribution.Good++;
                else if (score >= 50) healthDistribution.Fair++;
                else healthDistribution.Poor++;
            });

            const ctx = document.getElementById('healthChart');
            if (!ctx) return;

            if (charts.healthChart) charts.healthChart.destroy();

            charts.healthChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(healthDistribution),
                    datasets: [{
                        label: 'Databases',
                        data: Object.values(healthDistribution),
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.8)',
                            'rgba(139, 195, 74, 0.8)',
                            'rgba(255, 152, 0, 0.8)',
                            'rgba(244, 67, 54, 0.8)'
                        ],
                        borderColor: [
                            '#4caf50',
                            '#8bc34a',
                            '#ff9800',
                            '#f44336'
                        ],
                        borderWidth: 2,
                        borderRadius: 10,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            cornerRadius: 10
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { font: { weight: '600' } },
                            grid: { color: 'rgba(0, 0, 0, 0.1)' }
                        },
                        x: {
                            ticks: { font: { weight: '600' } },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function createActivityChart() {
            const ctx = document.getElementById('activityChart');
            if (!ctx) return;

            if (charts.activityChart) charts.activityChart.destroy();

            const last7Days = Array.from({length: 7}, (_, i) => {
                const date = new Date();
                date.setDate(date.getDate() - i);
                return date.toLocaleDateString();
            }).reverse();

            // Generate realistic activity data
            const activityData = [12, 19, 15, 25, 22, 18, 24];
            const syncData = [8, 12, 10, 18, 16, 14, 20];

            charts.activityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'Database Operations',
                        data: activityData,
                        borderColor: 'rgba(102, 126, 234, 1)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }, {
                        label: 'Sync Operations',
                        data: syncData,
                        borderColor: 'rgba(240, 147, 251, 1)',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointBackgroundColor: '#f093fb',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                font: { weight: '600' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            cornerRadius: 10
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { font: { weight: '600' } },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { font: { weight: '600' } },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        function updateAllCharts() {
            if (charts.categoryChart) {
                createCategoryChart();
            }
            if (charts.healthChart) {
                createHealthChart();
            }
        }

        function updateTopPerformers() {
            const cloudData = dashboardData.cloud || [];
            const topDatabases = cloudData
                .sort((a, b) => (b.health_score || 0) - (a.health_score || 0))
                .slice(0, 10);

            const tbody = document.getElementById('topPerformersBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            topDatabases.forEach((db, index) => {
                const row = document.createElement('tr');
                row.style.cursor = 'pointer';
                row.onclick = () => showDatabaseDetails(db.name);

                const healthClass = getHealthIndicatorClass(db.health_score || 0);
                const healthIcon = getHealthIcon(db.health_score || 0);

                row.innerHTML = `
                    <td style="font-weight: bold; color: ${index < 3 ? '#f4c430' : '#666'};">
                        ${index < 3 ? '🏆' : index + 1}
                    </td>
                    <td>
                        <div style="font-weight: 600;">${db.name}</div>
                        <div style="font-size: 0.8rem; color: #666;">${db.category || 'unknown'}</div>
                    </td>
                    <td>
                        <div class="health-indicator ${healthClass}">
                            ${healthIcon}
                            ${(db.health_score || 0).toFixed(1)}%
                        </div>
                    </td>
                    <td style="font-weight: 600;">
                        ${(db.row_count || 0).toLocaleString()}
                    </td>
                `;

                tbody.appendChild(row);
            });
        }

        function filterCards(searchTerm) {
            const cards = document.querySelectorAll('.dashboard-card');
            searchTerm = searchTerm.toLowerCase();

            cards.forEach(card => {
                const title = card.querySelector('.card-title').textContent.toLowerCase();
                const content = card.textContent.toLowerCase();
                
                if (title.includes(searchTerm) || content.includes(searchTerm)) {
                    card.style.display = 'block';
                    card.style.animation = 'fadeIn 0.3s ease-in-out';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function filterCardsByCategory(category) {
            const cards = document.querySelectorAll('.dashboard-card');

            cards.forEach(card => {
                if (category === 'all' || card.dataset.category === category) {
                    card.style.display = 'block';
                    card.style.animation = 'fadeIn 0.3s ease-in-out';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function startRealTimeUpdates() {
            setInterval(() => {
                if (realTimeMode) {
                    refreshAllData();
                }
            }, 30000); // 30 seconds
        }

        function startActivitySimulation() {
            const activities = [
                { type: 'sync', title: 'Database synchronization completed', icon: 'fas fa-sync' },
                { type: 'info', title: 'New service discovered', icon: 'fas fa-info' },
                { type: 'sync', title: 'Health check completed', icon: 'fas fa-heartbeat' },
                { type: 'info', title: 'Passport verified', icon: 'fas fa-shield-alt' },
                { type: 'sync', title: 'Service registered', icon: 'fas fa-check-circle' },
                { type: 'error', title: 'Connection timeout resolved', icon: 'fas fa-exclamation-triangle' }
            ];

            setInterval(() => {
                if (!activityPaused) {
                    const randomActivity = activities[Math.floor(Math.random() * activities.length)];
                    addActivityItem(randomActivity);
                }
            }, 15000); // Every 15 seconds
        }

        function addActivityItem(activity) {
            const feed = document.getElementById('activityFeed');
            const newItem = document.createElement('div');
            newItem.className = 'activity-item';
            newItem.style.animation = 'slideInRight 0.5s ease-out';

            newItem.innerHTML = `
                <div class="activity-icon ${activity.type}">
                    <i class="${activity.icon}"></i>
                </div>
                <div class="activity-content">
                    <div class="activity-title">${activity.title}</div>
                    <div class="activity-time">Just now</div>
                </div>
            `;

            feed.insertBefore(newItem, feed.firstChild);

            // Remove oldest items if more than 10
            while (feed.children.length > 10) {
                feed.removeChild(feed.lastChild);
            }
        }

        // Utility Functions
        function getHealthIndicatorClass(score) {
            if (score >= 90) return 'health-excellent';
            if (score >= 75) return 'health-good';
            if (score >= 50) return 'health-fair';
            return 'health-poor';
        }

        function getHealthIcon(score) {
            if (score >= 90) return '<i class="fas fa-check-circle"></i>';
            if (score >= 75) return '<i class="fas fa-thumbs-up"></i>';
            if (score >= 50) return '<i class="fas fa-exclamation-triangle"></i>';
            return '<i class="fas fa-times-circle"></i>';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${getNotificationIcon(type)}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => notification.classList.add('show'), 100);

            // Remove after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 5000);
        }

        function getNotificationIcon(type) {
            switch (type) {
                case 'success': return 'check-circle';
                case 'error': return 'times-circle';
                case 'warning': return 'exclamation-triangle';
                default: return 'info-circle';
            }
        }

        function closeModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        function saveLayoutToStorage() {
            // Implementation for saving layout to localStorage
            console.log('Layout saved to storage');
        }

        // Export functions to global scope
        window.refreshAllData = refreshAllData;
        window.triggerFullSync = function() {
            showNotification('Triggering full synchronization...', 'info');
            // Implementation for full sync
        };
        window.exportDashboard = function() {
            showNotification('Exporting dashboard data...', 'info');
            // Implementation for export
        };
        window.showSettings = function() {
            showNotification('Settings panel coming soon!', 'info');
        };
        window.pauseActivity = function() {
            activityPaused = !activityPaused;
            const icon = document.getElementById('activityToggle');
            icon.className = activityPaused ? 'fas fa-play' : 'fas fa-pause';
        };
        window.clearActivity = function() {
            document.getElementById('activityFeed').innerHTML = '';
            showNotification('Activity feed cleared', 'info');
        };

        // Initialize dashboard
        console.log('Advanced Card Dashboard initialized');
    </script>
</body>
</html>